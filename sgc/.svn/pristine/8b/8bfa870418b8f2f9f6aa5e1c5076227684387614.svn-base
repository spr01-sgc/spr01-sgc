/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

$(document).ready(function () {
    completaInputsEntidad();
    
});


/*
 * Función que sirve para dar de alta una nueva Entidad Financiera
 * @Author Juan Luis Mendiola 
 */
function agregarEntidad() {
    var razonsocial = $("#razonsocial").val();
    var nombrecorto = $("#nombrecorto").val();
    var correoelectronico = $("#correoelectronico").val();
    var rfc = $("#rfc").val();

    //Datos de la dirección
    var calle = $("#calle").val();
    var colonia = $("#colonia").val();
    var codigopostal = $("#codigopostal").val();

    //Datos de la persona

    var nombre = $("#nombre").val();
    var apaterno = $("#apaterno").val();
    var amaterno = $("#amaterno").val();
    var curp = $("#curp").val();
    var sexo = $("#sexo").val();
    var telefono = $("#numtelefono").val();
    var tipotelefono = $("#telefono").val();

    //Mensaje de al usuario
    var mensaje = "Espere mientras se insertan los datos";
    var mensajealerta = "Seguro que desea guardar los datos...";
    var regreso = "entidad/agregarEntidad";

    //falta extraer los datos de los campos de direccion y persona


    if (nombrecorto == '' || razonsocial == '' || correoelectronico == ''
            || rfc == '' || calle == '' || colonia == '') {
        alert("No dede de quedar un campo vacío");
        return;
    }

    if (codigopostal == 0) {
        alert("Debes de seleccionar un codigo postal")
    }
    var datos = [razonsocial,
        nombrecorto,
        correoelectronico,
        rfc,
        calle,
        colonia,
        codigopostal,
        nombre,
        apaterno,
        amaterno,
        curp,
        sexo,
        telefono,
        tipotelefono];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    //confirmar();
    jsShowWindowLoad(mensaje);
    $.ajax({
        url: "entidad/agregarEntidad",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("entidad");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }

    });
     jsRemoveWindowLoad();
}


/*
 * ´Función que sirve para actualizar una entidad
 * @Author Juan Luis Mendiola Gutiérrez
 */

function actualizarEntidad() {
    var razonsocialid = $("#razonsocialid").val();
    var razonsocial = $("#razonsocial").val();
    var nombrecorto = $("#nombrecorto").val();
    var correoelectronico = $("#correoelectronico").val();
    var rfc = $("#rfc").val();

    //Datos de la dirección de la entidad
    var calle = $("#calle").val();
    var colonia = $("#colonia").val();
    var codigopostal = $("#codigopostal").val();

    //Datos de la persona
    var nombre = $("#nombre").val();
    var apaterno = $("#apaterno").val();
    var amaterno = $("#amaterno").val();
    var curp = $("#curp").val();
    var sexo = $("#sexo").val();



    if (nombrecorto == '' || razonsocial == '' || correoelectronico == ''
            || rfc == '') {
        alert("No dede de quedar un campo vacío");
        return;
    }

    /*if (codigopostal == 0){
     alert("Debes de seleccionar un codigo postal")
     }*/
    var datos = [razonsocial,
        nombrecorto,
        correoelectronico,
        rfc,
        calle,
        colonia,
        codigopostal,
        nombre,
        apaterno,
        amaterno,
        curp,
        sexo,
        razonsocialid];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });

    $.ajax({
        url: "entidad/actualizarEntidad",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("entidad");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }

    });
}
/*
 * Función que sirve para eleiminar una Entidad Financiera 
 * @returns 
 */

function eliminarEntidad(entidadid) {

    var datos = [entidadid];

    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });

    $.ajax({
        url: "entidad/eliminarEntidad",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("entidad");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }

    });

}



/*
 * Método que llena las cajas de texto al momento de actualizar una entidad
 */

function completaInputsEntidad() {

    $("#tableEntidad tbody").on('click', 'tr', function () {
        var razonsocialid = $('td', this).eq(0).text();
        var razonsocial = $('td', this).eq(1).text();
        var nombrecorto = $('td', this).eq(2).text();
        var correoelectronico = $('td', this).eq(3).text();
        var rfc = $('td', this).eq(4).text();
        var calle = $('td', this).eq(5).text();
        var colonia = $('td', this).eq(6).text();
        var codigopostal = $('td', this).eq(7).text();
        var nombre = $('td', this).eq(9).text();
        var apaterno = $('td', this).eq(10).text();
        var amaterno = $('td', this).eq(11).text();
        var curp = $('td', this).eq(12).text();
        var sexo = $('td', this).eq(13).text();


        $("#razonsocialid").val(razonsocialid);
        $("#razonsocial").val(razonsocial);
        $("#nombrecorto").val(nombrecorto);
        $("#correoelectronico").val(correoelectronico);
        $("#rfc").val(rfc);
        $("#calle").val(calle);
        $("#colonia").val(colonia);
        $("#codigopostal").val(codigopostal).text();
        $("#nombre").val(nombre);
        $("#apaterno").val(apaterno);
        $("#amaterno").val(amaterno);
        $("#curp").val(curp);
        $("#sexo").val(sexo);


    });
}

/**
 * Función que sirve para bloquear la pantalla cuando se ejecuta una acción
 * @author Juan Luis Mendiola Gutiérrez
 */

function jsRemoveWindowLoad() {
    // eliminamos el div que bloquea pantalla
    $("#WindowLoad").remove();

}

function jsShowWindowLoad(mensaje) {
    //eliminamos si existe un div ya bloqueando
    jsRemoveWindowLoad();

    //si no enviamos mensaje se pondra este por defecto
    if (mensaje === undefined)
        mensaje = "Procesando la información<br>Espere por favor";

    //centrar imagen gif
    height = 20;//El div del titulo, para que se vea mas arriba (H)
    var ancho = 0;
    var alto = 0;

    //obtenemos el ancho y alto de la ventana de nuestro navegador, compatible con todos los navegadores
    if (window.innerWidth == undefined)
        ancho = window.screen.width;
    else
        ancho = window.innerWidth;
    if (window.innerHeight == undefined)
        alto = window.screen.height;
    else
        alto = window.innerHeight;

    //operación necesaria para centrar el div que muestra el mensaje
    var heightdivsito = alto / 2 - parseInt(height) / 2;//Se utiliza en el margen superior, para centrar

    //imagen que aparece mientras nuestro div es mostrado y da apariencia de cargando
    imgCentro = "<div style='text-align:center;height:" + alto + "px;'>\n\
                 <div  style='color:#000;margin-top:" + heightdivsito + "px; font-size:20px;font-weight:bold'>" + mensaje + "</div>\n\
                 <img  src='<%= request.getContextPath()%> /assets/img/load.gif'></div>";

    //creamos el div que bloquea grande------------------------------------------
    div = document.createElement("div");
    div.id = "WindowLoad"
    div.style.width = ancho + "px";
    div.style.height = alto + "px";
    $("body").append(div);

    //creamos un input text para que el foco se plasme en este y el usuario no pueda escribir en nada de atras
    input = document.createElement("input");
    input.id = "focusInput";
    input.type = "text"

    //asignamos el div que bloquea
    $("#WindowLoad").append(input);

    //asignamos el foco y ocultamos el input text
    $("#focusInput").focus();
    $("#focusInput").hide();

    //centramos el div del texto
    $("#WindowLoad").html(imgCentro);

}


function confirmar() {
    confirmar = confirm("�Te gusta nuestra web?");
    if (confirmar)
// si pulsamos en aceptar
        alert('Has dicho que si');
    else
// si pulsamos en cancelar
        alert('Has dicho que no');
} 

/**
 * Función para limpiar las cajas de una entidad
 * 
 */
function limpiarCajasEntidad() {
    $("#nombre").val("");
}


/**
 * Función para agregar una sucursal
 */
function agregarSucursal() {
  
    var nombresucursal = $("#nombresucursal").val();
    var nosucursal = $("#nosucursal").val();
    var correoelectronico = $("#correoelectronico").val();

    //Datos de la dirección
    var calle = $("#calle").val();
    var colonia = $("#colonia").val();
    var codigopostal = $("#codigopostal").val();

    //Datos de la persona

    var nombre = $("#nombre").val();
    var apaterno = $("#apaterno").val();
    var amaterno = $("#amaterno").val();
    var curp = $("#curp").val();
    var sexo = $("#sexo").val();
    var telefono = $("#numtelefono").val();
    var tipotelefono = $("#telefono").val();
    
    var entidad = $("#entidadF").val();

    //Mensaje de al usuario
    var mensaje = "Espere mientras se insertan los datos";
    var mensajealerta = "Seguro que desea guardar los datos...";
    var regreso = "entidad/agregarEntidad";

    //falta extraer los datos de los campos de direccion y persona


    if (nombresucursal == '' || nosucursal == '' || correoelectronico == ''
            || calle == '' || colonia == '' || nombre == '' || apaterno == ''
            || amaterno == '' || curp == '' || telefono == '') {
        alert("No dede de quedar un campo vacío");
        return;
    }
    if(codigopostal == 0){
        alert("Debes de seleccionar un código postal")
    }
    if(sexo == 0){
        alert("Debes de seleccionar el sexo de la persona")
    }
    if(tipotelefono == 0){
        alert("Debes de seleccionar el tipo de telefono")
    }

    var datos = [nombresucursal,
        nosucursal,
        correoelectronico,
        calle,
        colonia,
        codigopostal,
        nombre,
        apaterno,
        amaterno,
        curp,
        sexo,
        telefono,
        tipotelefono,
        entidad];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    //confirmar();
    jsShowWindowLoad(mensaje);
    $.ajax({
        url: "sucursal/agregarSucursal",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("sucursal");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }

    });
     jsRemoveWindowLoad();
} 

/*
 * Función que sirve para actualizar una sucursal
 * @param {type} sucursalid
 * @returns {undefined}
 */

function actualizarSucursal() {
    var sucursalid = $("#sucursalid").val();
    var nombresucursal = $("#nombresucursal").val();
    var nosucursal = $("#nosucursal").val();
    var correoelectronico = $("#correoelectronico").val();

    //Datos de la dirección
    var calle = $("#calle").val();
    var colonia = $("#colonia").val();
    var codigopostal = $("#codigopostal").val();

    //Datos de la persona

    var nombre = $("#nombre").val();
    var apaterno = $("#apaterno").val();
    var amaterno = $("#amaterno").val();
    var curp = $("#curp").val();
    var sexo = $("#sexo").val();
    var telefono = $("#numtelefono").val();
    var tipotelefono = $("#telefono").val();
    
    var entidad = $("#entidadF").val();

    //Mensaje de al usuario
    var mensaje = "Espere mientras se insertan los datos";
    var mensajealerta = "Seguro que desea guardar los datos...";
    var regreso = "entidad/agregarEntidad";

    //falta extraer los datos de los campos de direccion y persona


    if (nombresucursal == '' || nosucursal == '' || correoelectronico == ''
            || calle == '' || colonia == '' || nombre == '' || apaterno == ''
            || amaterno == '' || curp == '' || telefono == '') {
        alert("No dede de quedar un campo vacío");
        return;
    }
    if(codigopostal == 0){
        alert("Debes de seleccionar un código postal")
    }
    if(sexo == 0){
        alert("Debes de seleccionar el sexo de la persona")
    }
    if(tipotelefono == 0){
        alert("Debes de seleccionar el tipo de telefono")
    }
    
    var datos = [nombresucursal,
        nosucursal,
        correoelectronico,
        calle,
        colonia,
        codigopostal,
        nombre,
        apaterno,
        amaterno,
        curp,
        sexo,
        telefono,
        tipotelefono,
        entidad,
        sucursalid];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    //confirmar();
    jsShowWindowLoad(mensaje);
    $.ajax({
        url: "sucursal/actualizarSucursal",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("sucursal");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }

    });
     jsRemoveWindowLoad();
} 


/**
 * Función que sirve para eliminar una sucursal
 */

function eliminarSucursal(sucursalid) {

    var datos = [sucursalid];
    alert(sucursalid);

    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });

    $.ajax({
        url: "sucursal/eliminarSucursal",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("sucursal");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
        
        

    });

}

function completaInputsSucursal() {
    $("#guardar").prop("disabled", true);
    $("#actualizar").prop("disabled", false);

    $("#tableSucursal tbody").on('click', 'tr', function () {
        var sucursalid = $('td', this).eq(0).text();
        var nombresucursal = $('td', this).eq(1).text();
        var nosucursal = $('td', this).eq(2).text();
        var correoelectronico = $('td', this).eq(3).text();
        var calle = $('td', this).eq(4).text();
        var colonia = $('td', this).eq(5).text();
        var codigopostal = $('td', this).eq(6).text();
        var nombre = $('td', this).eq(8).text();
        var apaterno = $('td', this).eq(9).text();
        var amaterno = $('td', this).eq(10).text();
        var curp = $('td', this).eq(11).text();
        var sexo = $('td', this).eq(12).text();
        var entidad = $('td', this).eq(14).text();


        $("#sucursalid").val(sucursalid);
        $("#nombresucursal").val(nombresucursal);
        $("#nosucursal").val(nosucursal);
        $("#correoelectronico").val(correoelectronico);
        $("#calle").val(calle);
        $("#colonia").val(colonia);
        $("#codigopostal").val(codigopostal).text();
        $("#nombre").val(nombre);
        $("#apaterno").val(apaterno);
        $("#amaterno").val(amaterno);
        $("#curp").val(curp);
        $("#sexo").val(sexo);
        $("#entidadF").val(entidad);


    });
}
