$.noConflict();//trabaja diferentes versiones jquery
$(document).ready(function () {
    //delito
    $("#guardarD").prop("disabled", false);
    $("#actualizarD").prop("disabled", true);
    //ocultar o mostrar BOTONES giro 
    $("#guardarG").prop("disabled", false);
    $("#actualizarG").prop("disabled", true);
    //habilitar y desabilitar botones agregar familliar
    $("#AgregarF").click(function () {
        $("#GuardarF").css("display", "inline");
        $("#ActualizarF").prop("disabled", true);
    });
    //habilitar y desabilitar botones agregar pep
    $("#agregarPep").click(function () {
        $("#guardarPep").css("display", "inline");
        $("#actualizarPep").prop("disabled", true);
    });
    //mostrar pba
    $("#agregarPba").click(function () {
        $("#guardarPba").css("display", "inline");
        $("#actualizarPba").prop("disabled", true);
    });
    //pasar los datos de PLD
    $('#pasar').click(function () {
        return !$('#tramiteClientes option:selected').remove().appendTo('#tramiteClientesSeleccionados');
    });
    $('#quitar').click(function () {
        return !$('#tramiteClientesSeleccionados option:selected').remove().appendTo('#tramiteClientes');
    });
    $('#pasarTodo').click(function () {
        return !$('#tramiteClientes option').remove().appendTo('#tramiteClientesSeleccionados');
    });
    $('#quitarTodo').click(function () {
        return !$('#tramiteClientesSeleccionados option').remove().appendTo('#tramiteClientes');
    });

});//ready

function conversion() {
    var dolares = $("#dolaresPld").val();
    var valor = $("#valorDolarPld").val();
    var conversion = parseFloat(valor) * parseFloat(dolares);
//cambia el  valor de la etiqueta Relevantes
    document.getElementById('pesosPld').innerHTML = conversion + ".00";
}
function btnUsuario() {
    //agregar usuario se deshabilita el boton actualizar
    $("#guardarU").css("display", "inline");
    $("#actualizarU").prop("disabled", true);
}
function verTablaF() {
    //ocultar o mostrar pantalla familiar
    $("#familiar").css("display", "block");
    $("#mostrarFamiliar").css("display", "none");
    $("#pep1").css("display", "none");
}
function verTablaP() {
    //ver PEP}    
    $("#pep1").css("display", "inline");
    $("#familiar").css("display", "none");
    $("#mostrarFamiliar").css("display", "block");
}
function limpiarCajas() {
    $("#nombreD").val("");
    $("#nombreG").val("");
    $("#claveD").val("");
    $("#claveG").val("");
}
function busquedaTbl(tabla) {
    var tableReg = document.getElementById(tabla);
    var searchText = document.getElementById('search').value.toLowerCase();
    for (var i = 1; i < tableReg.rows.length; i++) {
        var cellsOfRow = tableReg.rows[i].getElementsByTagName('td');
        var found = false;
        for (var j = 0; j < cellsOfRow.length && !found; j++) {
            var compareWith = cellsOfRow[j].innerHTML.toLowerCase();
            if (searchText.length === 0 || (compareWith.indexOf(searchText) > -1)) {
                found = true;
            }
        }
        if (found) {
            tableReg.rows[i].style.display = '';
        } else {
            tableReg.rows[i].style.display = 'none';
        }
    }
}
function busquedaTblF() {
    var tableReg = document.getElementById('tableFamilia');
    var searchText = document.getElementById('searchF').value.toLowerCase();
    for (var i = 1; i < tableReg.rows.length; i++) {
        var cellsOfRow = tableReg.rows[i].getElementsByTagName('td');
        var found = false;
        for (var j = 0; j < cellsOfRow.length && !found; j++) {
            var compareWith = cellsOfRow[j].innerHTML.toLowerCase();
            if (searchText.length === 0 || (compareWith.indexOf(searchText) > -1)) {
                found = true;
            }
        }
        if (found) {
            tableReg.rows[i].style.display = '';
        } else {
            tableReg.rows[i].style.display = 'none';
        }
    }
}
function mostratFam() {
    $("#GuardarF").css("display", "none");
    $("#ActualizarF").prop("disabled", false);
    $("#tableFamilia tbody").on('click', 'tr', function () {
        var IdFamiliarT = $('td', this).eq(0).text().trim();
        $("#idfam").val(IdFamiliarT);
        var IdPepT = $('td', this).eq(2).text().trim();
        $("#idPep").val(IdPepT);
        var nomFamT = $('td', this).eq(4).text().trim();
        $("#nomFam").val(nomFamT);
        var apPatFamT = $('td', this).eq(5).text().trim();
        $("#apPatFam").val(apPatFamT);
        var apMatFamT = $('td', this).eq(6).text().trim();
        $("#apMatFam").val(apMatFamT);
        var curpFamT = $('td', this).eq(7).text().trim();
        $("#curpFam").val(curpFamT);
        var sexoFamT = $('td', this).eq(8).text().trim();
        $("#sexoFam").val(sexoFamT);
        var parentFamT = $('td', this).eq(10).text().trim();
        $("#parentescoFam").val(parentFamT);
    });
}
function mostrarGiDe() {
    $("#guardarD").prop("disabled", true);//deshabilita boton Guardar
    $("#actualizarD").prop("disabled", false);//habilita el btn Actualizar
    $("#guardarG").prop("disabled", true);
    $("#actualizarG").prop("disabled", false);
    $("#tableCatalogo tbody").on('click', 'tr', function () {
        var idT = $('td', this).eq(0).text();
        $("#delid").val(idT);
        var claveDT = $('td', this).eq(2).text();
        $("#claveD").val(claveDT);
        var nombreT = $('td', this).eq(3).text();
        $("#nombreD").val(nombreT);
//Giro
        var idgiT = $('td', this).eq(0).text();
        $("#idgiro").val(idgiT);
        var nombreGT = $('td', this).eq(3).text();
        $("#nombreG").val(nombreGT);
        var claveGT = $('td', this).eq(2).text();
        $("#claveG").val(claveGT);
    });
}
function mostrarPBA() {
    $("#guardarPba").css("display", "none");
    $("#actualizarPba").prop("disabled", false);
    //muestra los datos de un pba
    $("#tablePba tbody").on('click', 'tr', function () {
        //id de pba
        var idpbaT = $('td', this).eq(0).text();
        $("#idpba").val(idpbaT);
        var numExpT = $('td', this).eq(2).text();
        $("#noEx").val(numExpT);
        var fechBusT = $('td', this).eq(3).text().trim();
        $("#fechBus").val(fechBusT);
        var nomPbaT = $('td', this).eq(4).text();
        $("#nomPba").val(nomPbaT);
        var apPbaT = $('td', this).eq(5).text();
        $("#apPat").val(apPbaT);
        var amPbaT = $('td', this).eq(6).text();
        $("#apMat").val(amPbaT);
        var curpT = $('td', this).eq(7).text();
        $("#curpPba").val(curpT);
        var sexPbaT = $('td', this).eq(8).text().trim();
        $("#sexoPba").val(sexPbaT);
        var delitoPbaT = $('td', this).eq(10).text().trim();
        $("#delitoPba").val(delitoPbaT);
        var organizacionPbaT = $('td', this).eq(12).text().trim();
        $("#organizaciónPba").val(organizacionPbaT);
        var infoIdPbaT = $('td', this).eq(14).text().trim();
        $("#inforId").val(infoIdPbaT);
        var informacionPbaT = $('td', this).eq(15).text();
        $("#tituloPba").val(informacionPbaT);
        var infoDescrPbaT = $('td', this).eq(16).text();
        $("#descripPba").val(infoDescrPbaT);
        var paisT = $('td', this).eq(17).text().trim();
        $("#paisPba").val(paisT);
        var estaPbaT = $('td', this).eq(19).text().trim();
        $("#estatusPba").val(estaPbaT);
    });
}
/*Funcion que muestra la informacion de la tabla usuario en el formulario*/
function mostrarUsuario() {
    $("#guardarU").css("display", "none");//oculta el boton guardar
    $("#actualizarU").prop("disabled", false);//habilita el boton actualizar
    //al dar clic lo que tiene en el renglo lo pase a la caja de texto
    $("#tableUsuario tbody").on('click', 'tr', function () {
//id de usuario a actualizar
        var idusuariT = $('td', this).eq(20).text();
        $("#idusuario").val(idusuariT);
//informacion del usuario
        var nickuserT = $('td', this).eq(1).text();
        $("#nick").val(nickuserT);
        var passuserT = $('td', this).eq(2).text();
        $("#pass").val(passuserT);
        var emailuserT = $('td', this).eq(3).text();
        $("#email").val(emailuserT);
        var roluserT = $('td', this).eq(4).text();
        $("#roluser").val(roluserT);
        var estatusT = $('td', this).eq(6).text();
        $("#estatususer").val(estatusT);
        var nombreT = $('td', this).eq(8).text();
        $("#name").val(nombreT);
        var apaternoT = $('td', this).eq(9).text();
        $("#apaterno").val(apaternoT);
        var amaternoT = $('td', this).eq(10).text();
        $("#amaterno").val(amaternoT);
        var curpT = $('td', this).eq(11).text();
        $("#curp").val(curpT);
        var sexoT = $('td', this).eq(12).text().trim();
        $("#sexuser").val(sexoT);
        var tiptelT = $('td', this).eq(14).text();
        $("#tipTelU").val(tiptelT);
        var idtelT = $('td', this).eq(16).text();
        $("#idtel").val(idtelT);
        var numtelT = $('td', this).eq(17).text();
        $("#numtel").val(numtelT);
        var sucursal = $('td', this).eq(18).text();
        $("#sucursalUs").val(sucursal);
    });
}
//Limpia las cajas de texto formulario Usuario
function limpiarForm(frm) {
    document.getElementById(frm).reset();
}
function mostrarPEP() {
    $("#guardarPep").css("display", "none");
    $("#actualizarPep").prop("disabled", false);
    $("#tablePEP tbody").on('click', 'tr', function () {
        //idpep
        var idpepT = $('td', this).eq(0).text();
        $("#idpep").val(idpepT);
//PEP
        var fechaVigenteT = $('td', this).eq(2).text().trim();
        $("#fechPep").val(fechaVigenteT);
        var cargoT = $('td', this).eq(3).text().trim();
        $("#cargoPep").val(cargoT);
        var ciudadT = $('td', this).eq(5).text().trim();
        $("#ciudadPep").val(ciudadT);
        var nomT = $('td', this).eq(7).text().trim();
        $("#nomPep").val(nomT);
        var apPepT = $('td', this).eq(8).text().trim();
        $("#apPatPep").val(apPepT);
        var amPepT = $('td', this).eq(9).text().trim();
        $("#apMatPep").val(amPepT);
        var curpPepT = $('td', this).eq(10).text().trim();
        $("#curpPep").val(curpPepT);
        var sexPepT = $('td', this).eq(11).text().trim();
        $("#sexoPep").val(sexPepT);
        var estatPepT = $('td', this).eq(13).text().trim();
        $("#estatusPep").val(estatPepT);
    });
}
function agregarDelito() {
    var nombre = $("#nombreD").val();
    var clave = $("#claveD").val();
    if (nombre === '') {
        alert("El delito no puede ir vacío");
    }
    var datos = [nombre, clave];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "delito/agregarDelito",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("delito");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });//ajax
}
function actualizarDelito() {
    var id = $("#delid").val();
    var nombre = $("#nombreD").val();
    var claveD = $("#claveD").val();
    if ((nombre === '') && (id === '')) {
        alert("El delito no puede ir vació");
        return;
    }
    var datos = [id, nombre, claveD];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "delito/actualizarDelito",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("delito");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }

    });

}
function eliminarDelito() {
    $("#tableCatalogo tbody").on('click', 'tr', function () {
        var idT = $('td', this).eq(0).text();
        $("#iddelito").val(idT);
        var id = $("#iddelito").val();
        if (id === '') {
            alert("El delito no puede ir vació");
            return;
        }
        var datos = [id];
        $(document).ajaxSend(function (e, xhr, options) {
            var token = $("input[name='_csrf']").val();
            var cabecera = "X-CSRF-TOKEN";
            xhr.setRequestHeader(cabecera, token);
        });

        $.ajax({
            url: "delito/eliminarDelito",
            data: {datos: datos},
            dataType: 'html',
            type: 'POST',
            success: function (retorno) {
                //alert(retorno);
                switch (retorno) {
                    case 'errorDato':
                        alert("Los datos no se procesaron correctamente");
                        break;
                    case 'error':
                        alert("Se ha producido un error en el servidor");
                        break;
                    case 'exito':
                        //carga lo que se indica en id DIV
                        $("#pantalla").load("delito");
                        break;
                    case 'errorAcceso':
                        alert("No ha iniciado sesion");
                        break;
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert("Se ha producido un error en el servidor");
            }
        });
    });
}
function agregarGiro() {
    var nombre = $("#nombreG").val();
    var clave = $("#claveG").val();
    if (nombre === '' || clave === '') {
        alert("El giro no puede ir vacío");
        return;
    }
    var datos = [nombre, clave];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "giro/agregarGiro",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("giro");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            if (jqXHR.status === 0) {
                alert('Not connect: Verify Network.');
            } else if (jqXHR.status === 404) {
                alert('Requested page not found [404]');
            } else if (jqXHR.status === 500) {
                alert('Internal Server Error [500].');
            } else if (textStatus === 'parsererror') {
                alert('Requested JSON parse failed.');
            } else if (textStatus === 'timeout') {
                alert('Time out error.');
            } else if (textStatus === 'abort') {
                alert('Ajax request aborted.');
            } else {
                alert('Uncaught Error: ' + jqXHR.responseText);
            }
            //alert("Se ha producido un error en el servidor red");
        }
    });
}
function actualizarGiro() {
    var id = $("#idgiro").val();
    var nombre = $("#nombreG").val();
    var clave = $("#claveG").val();
    if (nombre === '') {
        alert("El giro no puede ir vació");
        return;
    }
    var datos = [id, nombre, clave];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "giro/actualizarGiro",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("giro");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}
function eliminarGiro() {
    $("#tableCatalogo tbody").on('click', 'tr', function () {
        var idT = $('td', this).eq(0).text();
        $("#idgiro").val(idT);
        var id = $("#idgiro").val();
        if (id === '') {
            alert("El giro no puede ir vació");
            return;
        }
        var datos = [id];
        $(document).ajaxSend(function (e, xhr, options) {
            var token = $("input[name='_csrf']").val();
            var cabecera = "X-CSRF-TOKEN";
            xhr.setRequestHeader(cabecera, token);
        });
        $.ajax({
            url: "giro/eliminarGiro",
            data: {datos: datos},
            dataType: 'html',
            type: 'POST',
            success: function (retorno) {
                //alert(retorno);
                switch (retorno) {
                    case 'errorDato':
                        alert("Los datos no se procesaron correctamente");
                        break;
                    case 'error':
                        alert("Se ha producido un error en el servidor");
                        break;
                    case 'exito':
                        //carga lo que se indica en id DIV
                        $("#pantalla").load("giro");
                        break;
                    case 'errorAcceso':
                        alert("No ha iniciado sesion");
                        break;
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert("Se ha producido un error en el servidor");
            }
        });

    });
}
/*Funcion que permite Agregar un nuevo usuario*/
function agregarUsuario() {
    var nick = $("#nick").val();
    var pass = $("#pass").val();
    var email = $("#email").val();
    var rol = $("#roluser").val();
    var estatus = $("#estatususer").val();
    var nombre = $("#name").val();
    var apaterno = $("#apaterno").val();
    var amaterno = $("#amaterno").val();
    var curp = $("#curp").val();
    var sexo = $("#sexuser").val();
    var tipTel = $("#tipTelU").val();
    var tel = $("#numtel").val();
    var suc = $("#sucursalUs").val();
    var tipTel2 = $("#tipTel2").val();
    var tel2 = $("#numtel2").val();

    /* if (nick === '' || pass === '' || email === '' || nombre === '' || apaterno === '' || amaterno === '' || curp === '' || tel === '') {
     alert("El usuario no puede ir vacío");
     return;
     }*/
    //if(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3,4})+$/.test(email)){//un num,una letra un @
    /*if (email.validity.typeMismatch) {
     email.setCustomValidity("¡Yo esperaba una dirección de correo, cariño!");
     } else {
     email.setCustomValidity("");
     }*/

    /*   alert("Email incorrecto");
     return;
     }*/
    if (rol === 0) {
        alert("Deseleccionar una opcion");
        return;
    }
    if (estatus === 0) {
        alert("Deseleccionar una opcion");
        return;
    }
    if (sexo === 0) {
        alert("Deseleccionar una opcion");
        return;
    }
    if (tipTel === 0) {
        alert("Deseleccionar una opcion");
        return;
    }
    var datos = [nick, pass, email, rol, estatus, nombre, apaterno,
        amaterno, curp, sexo, tipTel, tel, suc, tipTel2, tel2];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "usuario/agregarUsuario",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("usuario");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }

    });
}
function actualizarUsuario() {
    var nick = $("#nick").val();
    var pass = $("#pass").val();
    var email = $("#email").val();
    var rol = $("#roluser").val();
    var estatus = $("#estatususer").val();
    var nombre = $("#name").val();
    var apaterno = $("#apaterno").val();
    var amaterno = $("#amaterno").val();
    var curp = $("#curp").val();
    var sexo = $("#sexuser").val();
    var tipTel = $("#tipTelU").val();
    var IDtel = $("#idtel").val();
    var tel = $("#numtel").val();
    var suc = $("#sucursalUs").val();
    var id = $("#idusuario").val();

    if (nick === '' || pass === '' || nombre === '' || apaterno === ''
            || amaterno === '' || curp === '' || IDtel === '' || tel === '') {
        alert("El usuario no puede ir vacío");
        return;
    }
    if (rol === 0) {
        alert("Deseleccionar una opcion");
        return;
    }
    if (estatus === 0) {
        alert("Deseleccionar una opcion");
        return;
    }
    if (sexo === 0) {
        alert("Deseleccionar una opcion");
        return;
    }
    if (tipTel === 0) {
        alert("Deseleccionar una opcion");
        return;
    }
    var datos = [nick, pass, email, rol, estatus, id, nombre, apaterno, amaterno, curp, sexo, tipTel, IDtel, tel, suc];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "usuario/actualizarUsuario",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        async: true,
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("usuario");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}
function eliminarUsuario() {
    $("#tableUsuario tbody").on('click', 'tr', function () {
        var idT = $('td', this).eq(20).text();
        $("#iduser").val(idT);
        var id = $("#iduser").val();
        if (id == '') {
            alert("El user no puede ir vació");
            return;
        }
        var datos = [id];
        $(document).ajaxSend(function (e, xhr, options) {
            var token = $("input[name='_csrf']").val();
            var cabecera = "X-CSRF-TOKEN";
            xhr.setRequestHeader(cabecera, token);
        });

        $.ajax({
            url: "usuario/eliminarUsuario",
            data: {datos: datos},
            dataType: 'html',
            type: 'POST',
            success: function (retorno) {
                //alert(retorno);
                switch (retorno) {
                    case 'errorDato':
                        alert("Los datos no se procesaron correctamente");
                        break;
                    case 'error':
                        alert("Se ha producido un error en el servidor");
                        break;
                    case 'exito':
                        //carga lo que se indica en id DIV
                        $("#pantalla").load("usuario");
                        break;
                    case 'errorAcceso':
                        alert("No ha iniciado sesion");
                        break;
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert("Se ha producido un error en el servidor");
            }
        });

    });
}
function agregarPba() {
    var noEx = $("#noEx").val();
    var fechBus = $("#fechBus").val();
    var nomPba = $("#nomPba").val();
    var apPba = $("#apPat").val();
    var amPba = $("#apMat").val();
    var curp = $("#curpPba").val();
    var sexoPba = $("#sexoPba").val();
    var delitoPba = $("#delitoPba").val();
    var organizacionPba = $("#organizaciónPba").val();
    var tituloPba = $("#tituloPba").val();
    var descripcionPba = $("#descripPba").val();
    var pais = $("#paisPba").val();
    var estatusPba = $("#estatusPba").val();

    if (noEx.isEmpty) {
        alert("El nuemro de expediente no puede ir vacío");
        return;
    }
    if (fechBus.isEmpty || nomPba.isEmpty || apPba.isEmpty || amPba.isEmpty || curp.isEmpty || sexoPba.isEmpty || delitoPba.isEmpty || organizacionPba.isEmpty) {
        alert("El numero de expediente no puede ir vacío");
        return;
    }
    var datos = [noEx, fechBus, nomPba, apPba, amPba, curp, sexoPba, delitoPba, organizacionPba, tituloPba, descripcionPba, pais, estatusPba];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "pba/agregarPba",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("pba");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}
//actualizar PBA
function actualizarPba() {
    var idPba = $("#idpba").val();
    var noEx = $("#noEx").val();
    var fechBus = $("#fechBus").val();
    var nomPba = $("#nomPba").val();
    var apPba = $("#apPat").val();
    var amPba = $("#apMat").val();
    var curp = $("#curpPba").val();
    var sexoPba = $("#sexoPba").val();
    var delitoPba = $("#delitoPba").val();
    var organizacionPba = $("#organizaciónPba").val();
    var infoIdPba = $("#infId").val();
    var tituloPba = $("#tituloPba").val();
    var descripcionPba = $("#descripPba").val();
    var pais = $("#paisPba").val();
    var estatusPba = $("#estatusPba").val();

    var datos = [noEx, fechBus, nomPba, apPba, amPba, curp, sexoPba, delitoPba,
        organizacionPba, tituloPba, descripcionPba, pais, idPba, infoIdPba, estatusPba];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "pba/actualizarPba",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("pba");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}
function agregarPep() {
    var fechaVigenteT = $("#fechPep").val();
    var cargoT = $("#cargoPep").val();
    var ciudadT = $("#ciudadPep").val();
    var nomT = $("#nomPep").val();
    var apPepT = $("#apPatPep").val();
    var amPepT = $("#apMatPep").val();
    var curpPepT = $("#curpPep").val();
    var sexPepT = $("#sexoPep").val();
    var estatPepT = $("#estatusPep").val();

    var datos = [fechaVigenteT, cargoT, ciudadT, nomT, apPepT, amPepT, curpPepT, sexPepT, estatPepT];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "pep/agregarPep",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("pep");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}
function actualizarPep() {
    var IDpep = $("#idpep").val();
    var fechaVigenteT = $("#fechPep").val();
    var cargoT = $("#cargoPep").val();
    var ciudadT = $("#ciudadPep").val();
    var nomT = $("#nomPep").val();
    var apPepT = $("#apPatPep").val();
    var amPepT = $("#apMatPep").val();
    var curpPepT = $("#curpPep").val();
    var sexPepT = $("#sexoPep").val();
    var estatPepT = $("#estatusPep").val();

    var datos = [fechaVigenteT, cargoT, ciudadT, nomT, apPepT, amPepT, curpPepT, sexPepT, estatPepT, IDpep];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "pep/actualizarPep",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("pep");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}
function agregarFamiliar() {

    var IdPep = $("#idPep").val();
    var nomFam = $("#nomFam").val();
    var apPatFam = $("#apPatFam").val();
    var apMatFam = $("#apMatFam").val();
    var curpFam = $("#curpFam").val();
    var sexoFam = $("#sexoFam").val();
    var parentFam = $("#parentescoFam").val();

    var datos = [IdPep, nomFam, apPatFam, apMatFam, curpFam, sexoFam, parentFam];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "pep/agregarFamiliar",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("pep");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}
function actualizarFamiliar() {
    var IdFamiliar = $("#idfam").val();
    var IdPep = $("#idPep").val();
    var nomFam = $("#nomFam").val();
    var apPatFam = $("#apPatFam").val();
    var apMatFam = $("#apMatFam").val();
    var curpFam = $("#curpFam").val();
    var sexoFam = $("#sexoFam").val();
    var parentFam = $("#parentescoFam").val();

    var datos = [IdPep, nomFam, apPatFam, apMatFam, curpFam, sexoFam, parentFam, IdFamiliar];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "pep/actualizarFamiliar",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    $("#pantalla").load("pep");
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}
function eliminarFamiliar() {
    $("#tableFamili tbody").on('click', 'tr', function () {
        var idT = $('td', this).eq(0).text();
        $("#idfam").val(idT);
        var id = $("#idfam").val();
        if (id === '') {
            alert("El user no puede ir vació");
            return;
        }
        var datos = [id];
        $(document).ajaxSend(function (e, xhr, options) {
            var token = $("input[name='_csrf']").val();
            var cabecera = "X-CSRF-TOKEN";
            xhr.setRequestHeader(cabecera, token);
        });
        $.ajax({
            url: "pep/eliminarFamiliar",
            data: {datos: datos},
            dataType: 'html',
            type: 'POST',
            success: function (retorno) {
                //alert(retorno);
                switch (retorno) {
                    case 'errorDato':
                        alert("Los datos no se procesaron correctamente");
                        break;
                    case 'error':
                        alert("Se ha producido un error en el servidor");
                        break;
                    case 'exito':
                        //carga lo que se indica en id DIV
                        $("#pantalla").load("pep");
                        break;
                    case 'errorAcceso':
                        alert("No ha iniciado sesion");
                        break;
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert("Se ha producido un error en el servidor");
            }
        });
    });
}
function generarReportePLD() {
    $("#tramiteClientesSeleccionados option").each(function () {
        var datos = [];
        datos[$(this).attr('value')] = $(this).text();
        document.getElementById('nombrePLD').innerHTML = datos;
        alert('opcion: ' + datos);
    });
}
/**
 * Operaciones relevantes
 * @returns {cantidad de operaciones relevvantes}
 */

var intevalo = setInterval('notificacionRelevant()', 40000);


function notificacionRelevant() {
    var d = new Date();
    var hr = d.getHours();
    if (hr === 13) {
        var fecha = new Date();
        var fechaN = fecha.toDateString();
        var datos = [fechaN];
        $(document).ajaxSend(function (e, xhr, options) {
            var token = $("input[name='_csrf']").val();
            var cabecera = "X-CSRF-TOKEN";
            xhr.setRequestHeader(cabecera, token);
        });
        $.ajax({
            url: "operelevante/notOpRel",
            data: {datos: datos},
            dataType: 'html',
            type: 'GET',
            success: function (retorno) {
                //alert(retorno);
                var c = 1;
                var clientes = JSON.parse(retorno);
                for (var i in clientes) {
                    document.getElementById('report').innerHTML = c;
                    document.getElementById('relevante').innerHTML = c;
                    $("#report").attr("title", "Tienes notificaciones");
                    c++;
                }
                //
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert("Se ha producido un error en el servidor");
            }
        });
    }//if12
}
//muestra los clientes que cuentan con operaciones relevanes
function movimientosRelevantes() {
    var fechIn = document.getElementById("fechIni").value;
    var fechTe = document.getElementById("fechTer").value;
    var datos = [fechIn, fechTe];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "operelevante/tblRelevant",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            // alert(retorno);  
            $('#tblNotifR').css("display", "none")
            var pagoSQL = JSON.parse(retorno);
            var cont = 1;
            for (var i in pagoSQL) {

                var tr = document.createElement("tr");
                var td = document.createElement("td");
                var txt = document.createTextNode(cont);//No.
                var td1 = document.createElement("td");
                var txt1 = document.createTextNode(pagoSQL[i][0]);//claveClien
                var td2 = document.createElement("td");
                var txt2 = document.createTextNode(pagoSQL[i][3]);//NOmbre
                var td3 = document.createElement("td");
                var txt3 = document.createTextNode("$" + pagoSQL[i][1]);//Deposisto 
                var td4 = document.createElement("td");
                var txt4 = document.createTextNode("$" + pagoSQL[i][2]);//Retiro
                var td5 = document.createElement("td");
                var txt5 = document.createTextNode(pagoSQL[i][4]);//beneficiario

                td.appendChild(txt);
                tr.appendChild(td);
                td1.appendChild(txt1);
                tr.appendChild(td1);
                td2.appendChild(txt2);
                tr.appendChild(td2);
                td3.appendChild(txt3);
                tr.appendChild(td3);
                td4.appendChild(txt4);
                tr.appendChild(td4);
                td5.appendChild(txt5);
                tr.appendChild(td5);
                $("#tblConRel tbody").append(tr);
                cont = parseInt(cont) + 1;//genera num de filas
            }//ffor
            $("#tblRelevantes").css("display", "block");
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}
function reporteRelevantes(boton) {
    var fechIn = document.getElementById("fechIni").value;
    var fechTe = document.getElementById("fechTer").value;
    if (fechIn === "" && fechTe === "") {
        alert("No hay un rango de fechas seleccionado");
        return;
    }
    var datos = [fechIn, fechTe];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "operelevante/reporteRelevantes",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            // alert(retorno);      
            var pagoSQL = JSON.parse(retorno);

            var fecha = new Date();
            var mes = (fecha.getMonth()) + 1;
            var anio = fecha.getFullYear();
            var aniomes = anio + "0" + mes;
            var cont = 1;
            for (var i in pagoSQL) {

                var folio = 0;
                if (cont < 10) {
                    folio = "00000" + cont;
                }
                if (cont > 10 && cont < 100) {
                    folio = "0000" + cont;
                }
                if (cont > 100 & cont < 1000) {
                    folio = "000" + cont;
                }
                var tr = document.createElement("tr");
                var td = document.createElement("td");
                var txt = document.createTextNode(1);//tipo de reporte
                var td1 = document.createElement("td");
                var txt1 = document.createTextNode(aniomes);//periodoREporte
                var td2 = document.createElement("td");
                var txt2 = document.createTextNode(folio);//folio
                var td3 = document.createElement("td");
                var txt3 = document.createTextNode("00" + pagoSQL[i][0]);//OrganosSuperentidadfinanciera 001002
                var td4 = document.createElement("td");
                var txt4 = document.createTextNode("088" + pagoSQL[i][1]);//clave entidad 08821945
                var td5 = document.createElement("td");
                var txt5 = document.createTextNode(pagoSQL[i][2]);//localidad ciudad
                var td6 = document.createElement("td");
                var txt6 = document.createTextNode("0" + pagoSQL[i][3]);//Sucursal CP
                var td7 = document.createElement("td");
                var txt7 = document.createTextNode(pagoSQL[i][4]);//ct_tipOperacion
                var td8 = document.createElement("td");
                var txt8 = document.createTextNode(pagoSQL[i][5]);//instMon
                var td9 = document.createElement("td");
                var txt9 = document.createTextNode(pagoSQL[i][6]);//CLAVE Remesa Oficalcumplimineto
                var td10 = document.createElement("td");
                var txt10 = document.createTextNode(pagoSQL[i][7]);//monto
                var td11 = document.createElement("td");
                var txt11 = document.createTextNode(pagoSQL[i][9]);//moneda
                var td12 = document.createElement("td");
                var txt12 = document.createTextNode(pagoSQL[i][10]);//fecha operacion
                var td13 = document.createElement("td");
                var txt13 = document.createTextNode("");//FECHA DE DETECCIÓN DE LAOPERACIÓN*
                var td14 = document.createElement("td");
                var txt14 = document.createTextNode(1);//Nacionalidad 
                var td15 = document.createElement("td");
                var txt15 = document.createTextNode(1);//Las claves son: 1 = Persona Física, 2 = Persona Mora
                var td16 = document.createElement("td");
                var txt16 = document.createTextNode("");//RAZÓN SOCIAL P.Moral
                var td17 = document.createElement("td");
                var txt17 = document.createTextNode(pagoSQL[i][15]);//NOMBRE: del cuentahabiente
                var td18 = document.createElement("td");
                var txt18 = document.createTextNode(pagoSQL[i][16]);//APELLIDO PATERNO
                var td19 = document.createElement("td");
                var txt19 = document.createTextNode(pagoSQL[i][17]);//APELLIDO MATERNO
                var td20 = document.createElement("td");
                var txt20 = document.createTextNode("");//RFC no va en relevantes
                var td21 = document.createElement("td");
                var txt21 = document.createTextNode(pagoSQL[i][18]);//CURP
                var td22 = document.createElement("td");
                var txt22 = document.createTextNode("");//FECHA NAC O CONSTITU
                var td23 = document.createElement("td");
                var txt23 = document.createTextNode(pagoSQL[i][11]);//DOMICILIO Especificar el domicilio de la persona 
                //que se reporta de la siguiente manera: indicar la calle, número exterior e interior (si aplica), y código postal.
                var td24 = document.createElement("td");
                var txt24 = document.createTextNode(pagoSQL[i][12]);//COLONIA 
                var td25 = document.createElement("td");
                var txt25 = document.createTextNode(pagoSQL[i][14]);// CIUDAD
                var td26 = document.createElement("td");
                var txt26 = document.createTextNode("");//TELEFONO
                var td27 = document.createElement("td");
                var txt27 = document.createTextNode("");//ACTIVIDAD ECONOMICA
                var td28 = document.createElement("td");
                var txt28 = document.createTextNode(pagoSQL[i][19]);//Agente o Apoderado
                var td29 = document.createElement("td");
                var txt29 = document.createTextNode("");//ApePaterno
                var td30 = document.createElement("td");
                var txt30 = document.createTextNode("");//ApMatern
                var td31 = document.createElement("td");
                var txt31 = document.createTextNode(pagoSQL[i][20]);//RFC
                var td32 = document.createElement("td");
                var txt32 = document.createTextNode("");//curp
                var td33 = document.createElement("td");
                var txt33 = document.createTextNode("");//ConsecutivoCuentas
                var td34 = document.createElement("td");
                var txt34 = document.createTextNode("");//NumeroCunetaNSS
                var td35 = document.createElement("td");
                var txt35 = document.createTextNode("");//claveSujetoObliga
                var td36 = document.createElement("td");
                var txt36 = document.createTextNode("");//TitularCuenta
                var td37 = document.createElement("td");
                var txt37 = document.createTextNode("");//ApParteno
                var td38 = document.createElement("td");
                var txt38 = document.createTextNode("");//ApMaterno
                var td39 = document.createElement("td");
                var txt39 = document.createTextNode("");//Descripcion Operacion
                var td40 = document.createElement("td");
                var txt40 = document.createTextNode("");//Razones Insual Preocupante
                /* var tdBoton = document.createElement("td");
                 var x = document.createElement("INPUT");
                 x.setAttribute("type", "button");
                 x.setAttribute("value", "Eliminar");*/

                td.appendChild(txt);
                tr.appendChild(td);
                td1.appendChild(txt1);
                tr.appendChild(td1);
                td2.appendChild(txt2);
                tr.appendChild(td2);
                td3.appendChild(txt3);
                tr.appendChild(td3);
                td4.appendChild(txt4);
                tr.appendChild(td4);
                td5.appendChild(txt5);
                tr.appendChild(td5);
                td6.appendChild(txt6);
                tr.appendChild(td6);
                td7.appendChild(txt7);
                tr.appendChild(td7);
                td8.appendChild(txt8);
                tr.appendChild(td8);
                td9.appendChild(txt9);
                tr.appendChild(td9);
                td10.appendChild(txt10);
                tr.appendChild(td10);
                td11.appendChild(txt11);
                tr.appendChild(td11);
                td12.appendChild(txt12);
                tr.appendChild(td12);
                td13.appendChild(txt13);
                tr.appendChild(td13);
                td14.appendChild(txt14);
                tr.appendChild(td14);
                td15.appendChild(txt15);
                tr.appendChild(td15);
                td16.appendChild(txt16);
                tr.appendChild(td16);
                td17.appendChild(txt17);
                tr.appendChild(td17);
                td18.appendChild(txt18);
                tr.appendChild(td18);
                td19.appendChild(txt19);
                tr.appendChild(td19);
                td20.appendChild(txt20);
                tr.appendChild(td20);
                td21.appendChild(txt21);
                tr.appendChild(td21);
                td22.appendChild(txt22);
                tr.appendChild(td22);
                td23.appendChild(txt23);
                tr.appendChild(td23);
                td24.appendChild(txt24);
                tr.appendChild(td24);
                td25.appendChild(txt25);
                tr.appendChild(td25);
                td26.appendChild(txt26);
                tr.appendChild(td26);
                td27.appendChild(txt27);
                tr.appendChild(td27);
                td28.appendChild(txt28);
                tr.appendChild(td28);
                td29.appendChild(txt29);
                tr.appendChild(td29);
                td30.appendChild(txt30);
                tr.appendChild(td30);
                td31.appendChild(txt31);
                tr.appendChild(td31);
                td32.appendChild(txt32);
                tr.appendChild(td32);
                td33.appendChild(txt33);
                tr.appendChild(td33);
                td34.appendChild(txt34);
                tr.appendChild(td34);
                td35.appendChild(txt35);
                tr.appendChild(td35);
                td36.appendChild(txt36);
                tr.appendChild(td36);
                td37.appendChild(txt37);
                tr.appendChild(td37);
                td38.appendChild(txt38);
                tr.appendChild(td38);
                td39.appendChild(txt39);
                tr.appendChild(td39);
                td40.appendChild(txt40);
                tr.appendChild(td40);
                /* tdBoton.appendChild(x);
                 tr.appendChild(tdBoton)*/
                $("#tblOpRel tbody").append(tr);
                cont = parseInt(cont) + 1;//genera num de filas

            }//ffor
            // $("#tblORelevantes").css("display", "block");
            var nombre = 1 + "088" + pagoSQL[i][1] + aniomes + "." + "00" + pagoSQL[i][0];
            if (boton === 'csv') {
                csv('#tbRel', nombre);
            } else {
                Excel('#tblOpRel', nombre);
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}
/**
 * Funcion csv y Excel generar los reportes de operaciones 
 * preocupantes, insuale,relevantes
 * @param {type} tabla id de la tabla a leer
 * @param {type} nombre del archivo que se genera
 * @returns {file} archivo extencion csv separdo por comas
 */
function csv(tabla, nombre) {
    $(tabla).tableToCSV(nombre, "csv");
    $(tabla).empty();//limpiar tabla
}
function Excel(tabla, nombre) {
    //$("table").tableToCSV();
    $(tabla).tableToCSV(nombre, "excel");
    if (tabla === '#tblOpPre') {
        $("#tbPre").empty();//limpiar tabla
    } else if (tabla === '#tblOpRel') {
        $("#tbRel").empty();//limpiar tabla
    } else {
        //$("#tbInu").empty();//limpiar tabla
    }
}

/***
 * Funcion para Realizar una opracion Interna Preocupante
 * @param {int} valor 1= si, 2=no 
 * @returns {el usuario que hace la denuncia o bien solo se reciben los datos 
 * de la persona aquien se denuncia}
 */
function selectDenunciaAnonima(valor) {
    if (valor === 1) {
        $("#chNo").prop('checked', false);
        $("#divdenunciante").css("display", "none");
    }
    if (valor === 2) {
        $("#chSi").prop('checked', false);
        //buscar el usuario en sesion
        $(document).ajaxSend(function (e, xhr, options) {
            var token = $("input[name='_csrf']").val();
            var cabecera = "X-CSRF-TOKEN";
            xhr.setRequestHeader(cabecera, token);
        });
        $.ajax({
            url: "usuario/usuarioEnsesion",
            data: {datos: ''},
            dataType: 'html',
            type: 'GET',
            success: function (retorno) {
                var usuario = JSON.parse(retorno);
                $("#nickuser").val(usuario[0]);
                $("#emailUser").val(usuario[1]);
                $("#nombreUser").val(usuario[2]);
                $("#divdenunciante").css("display", "block");
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert("Se ha producido un error en el servidor");
            }
        });
    }//if
}

function denunciaPreocupante() {
    var nombreInfractor = $("#infractorname").val();
    var descripcion = $("#descripcionOp").val();
    var fecha = $("#fechSuceso").val();
    var usuarionick = $("#nickuser").val();
    var datos = [nombreInfractor, descripcion,
        fecha, usuarionick];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "opepreocupante/guardarOperacionP",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            var operacionesP = JSON.parse(retorno);
            var cant = 1;
            for (var i in operacionesP) {
                document.getElementById('report').innerHTML = cant;
                document.getElementById('preocupante').innerHTML = cant;
                $("#report").attr("title", "Tienes notificaciones");
                cant++;
            }
            limpiarForm('frmPreocupantes');
            $("#divdenunciante").prop("display", "none");

        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor red");
        }
    });//ajax
}
/**
 * Fincion para buscar infomacion adicional de la persona acusada
 * @returns {undefined}
 */
function buscarUsuarioPre() {
    $("#tablePreocupantes tbody").on('click', 'tr', function () {
        var nombreUsuario = $('td', this).eq(2).text();
        $("#nomAcusado").val(nombreUsuario);
        var datos = [nombreUsuario];
        $(document).ajaxSend(function (e, xhr, options) {
            var token = $("input[name='_csrf']").val();
            var cabecera = "X-CSRF-TOKEN";
            xhr.setRequestHeader(cabecera, token);
        });
        $.ajax({
            url: "usuario/buscarUsuarioP",
            data: {datos: datos},
            dataType: 'html',
            type: 'POST',
            success: function (retorno) {
                //alert(retorno);
                var datosUsuario = JSON.parse(retorno);
                console.log(datosUsuario);
                $("#nick").val(datosUsuario[0]);
                $("#email").val(datosUsuario[1]);
                $("#nameC").val(datosUsuario[2]);
                $("#sucursalS").val(datosUsuario[3]);
                $("#telefonoS").val(datosUsuario[4]);
                $("#idusuario").val(datosUsuario[5]);
                $("#curp").val(datosUsuario[6]);
                $("#sexo").val(datosUsuario[7]);

            }
        });//ajax
    });//tabla
}
function reportPreocupante(boton) {
    var arreglo = [];
    $("input[type=checkbox]:checked").each(function () {
        var cont = 1;
        $(this).closest('td').siblings().each(function () {
            // obtenemos el texto del td 
            if (cont === 3) {
                var dato = $(this).text();
                arreglo.push(dato);   //solo pasa los nombres hacer consulta Reporte con like
            }
            cont++;
            //console.log($(this).text());
        });
        console.log('Soy arreglo ' + arreglo);
    });//ya no hay selecion de mas
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "opepreocupante/reportePreocupante",
        data: {datos: arreglo},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            var operacionP = JSON.parse(retorno);
            //console.log(operacionP);   
            var fecha = new Date();
            var mes = (fecha.getMonth()) + 1;
            var anio = fecha.getFullYear();
            var dia = fecha.getDate();
            var periodo = anio + "0" + mes + dia;
            var cont = 1;
            for (var i in operacionP) {

                var folio = 0;
                if (cont < 10) {
                    folio = "00000" + cont;
                }
                if (cont > 10 && cont < 100) {
                    folio = "0000" + cont;
                }
                if (cont > 100 & cont < 1000) {
                    folio = "000" + cont;
                }
                var tr = document.createElement("tr");
                var td = document.createElement("td");
                var txt = document.createTextNode(3);//tipo de reporte
                var td1 = document.createElement("td");
                var txt1 = document.createTextNode(periodo);//periodoREporte
                var td2 = document.createElement("td");
                var txt2 = document.createTextNode(folio);//folio
                var td3 = document.createElement("td");
                var txt3 = document.createTextNode("00" + operacionP[i][0]);//OrganosSuperentidadfinanciera 001002
                var td4 = document.createElement("td");
                var txt4 = document.createTextNode("088" + operacionP[i][1]);//clave entidad 08821945
                var td5 = document.createElement("td");
                var txt5 = document.createTextNode(operacionP[i][2]);//localidad ciudad
                var td6 = document.createElement("td");
                var txt6 = document.createTextNode("0" + operacionP[i][3]);//Sucursal
                var td7 = document.createElement("td");
                var txt7 = document.createTextNode("");//ct_tipOperacion
                var td8 = document.createElement("td");
                var txt8 = document.createTextNode("");//instMon
                var td9 = document.createElement("td");
                var txt9 = document.createTextNode("");//NÚMERO DE CUENTA, CONTRATO, OPERACIÓN, PÓLIZA O NÚMERO DE SEGURIDAD SOCIAL Oficalcumplimineto
                var td10 = document.createElement("td");
                var txt10 = document.createTextNode("");//monto
                var td11 = document.createElement("td");
                var txt11 = document.createTextNode("");//moneda
                var td12 = document.createElement("td");
                var txt12 = document.createTextNode(operacionP[i][4]);//fecha operacion
                var td13 = document.createElement("td");
                var txt13 = document.createTextNode(operacionP[i][4]);//FECHA DE DETECCIÓN DE LAOPERACIÓN*
                var td14 = document.createElement("td");
                var txt14 = document.createTextNode(1);//Nacionalidad 
                var td15 = document.createElement("td");
                var txt15 = document.createTextNode("1");//Las claves son: 1 = Persona Física, 2 = Persona Mora
                var td16 = document.createElement("td");
                var txt16 = document.createTextNode("");//RAZÓN SOCIAL P.Moral
                var td17 = document.createElement("td");
                var txt17 = document.createTextNode(operacionP[i][5]);//NOMBRE: del cuentahabiente
                var td18 = document.createElement("td");
                var txt18 = document.createTextNode(operacionP[i][6]);//APELLIDO PATERNO
                var td19 = document.createElement("td");
                var txt19 = document.createTextNode(operacionP[i][7]);//APELLIDO MATERNO
                var td20 = document.createElement("td");
                var txt20 = document.createTextNode("");//RFC no va en relevantes
                var td21 = document.createElement("td");
                var txt21 = document.createTextNode(operacionP[i][8]);//CURP
                var td22 = document.createElement("td");
                var txt22 = document.createTextNode("");//FECHA NAC O CONSTITU
                var td23 = document.createElement("td");
                var txt23 = document.createTextNode("");//DOMICILIO Especificar el domicilio de la persona 
                //que se reporta de la siguiente manera: indicar la calle, número exterior e interior (si aplica), y código postal.
                var td24 = document.createElement("td");
                var txt24 = document.createTextNode("");//COLONIA 
                var td25 = document.createElement("td");
                var txt25 = document.createTextNode("");// CIUDAD
                var td26 = document.createElement("td");
                var txt26 = document.createTextNode(operacionP[i][9]);//TELEFONO
                var td27 = document.createElement("td");
                var txt27 = document.createTextNode("");//ACTIVIDAD ECONOMICA
                var td28 = document.createElement("td");
                var txt28 = document.createTextNode(operacionP[i][10]);//Agente o Apoderado
                var td29 = document.createElement("td");
                var txt29 = document.createTextNode("");//ApePaterno
                var td30 = document.createElement("td");
                var txt30 = document.createTextNode("");//ApMatern
                var td31 = document.createElement("td");
                var txt31 = document.createTextNode(operacionP[i][11]);//RFC
                var td32 = document.createElement("td");
                var txt32 = document.createTextNode("");//curp
                var td33 = document.createElement("td");
                var txt33 = document.createTextNode("");//ConsecutivoCuentas
                var td34 = document.createElement("td");
                var txt34 = document.createTextNode("");//NumeroCunetaNSS
                var td35 = document.createElement("td");
                var txt35 = document.createTextNode("");//claveSujetoObliga
                var td36 = document.createElement("td");
                var txt36 = document.createTextNode("");//TitularCuenta
                var td37 = document.createElement("td");
                var txt37 = document.createTextNode("");//ApParteno
                var td38 = document.createElement("td");
                var txt38 = document.createTextNode("");//ApMaterno
                var td39 = document.createElement("td");
                var txt39 = document.createTextNode("");//Descripcion Operacion
                var td40 = document.createElement("td");
                var txt40 = document.createTextNode(operacionP[i][12]);//Razones Insual Preocupante
                td.appendChild(txt);
                tr.appendChild(td);
                td1.appendChild(txt1);
                tr.appendChild(td1);
                td2.appendChild(txt2);
                tr.appendChild(td2);
                td3.appendChild(txt3);
                tr.appendChild(td3);
                td4.appendChild(txt4);
                tr.appendChild(td4);
                td5.appendChild(txt5);
                tr.appendChild(td5);
                td6.appendChild(txt6);
                tr.appendChild(td6);
                td7.appendChild(txt7);
                tr.appendChild(td7);
                td8.appendChild(txt8);
                tr.appendChild(td8);
                td9.appendChild(txt9);
                tr.appendChild(td9);
                td10.appendChild(txt10);
                tr.appendChild(td10);
                td11.appendChild(txt11);
                tr.appendChild(td11);
                td12.appendChild(txt12);
                tr.appendChild(td12);
                td13.appendChild(txt13);
                tr.appendChild(td13);
                td14.appendChild(txt14);
                tr.appendChild(td14);
                td15.appendChild(txt15);
                tr.appendChild(td15);
                td16.appendChild(txt16);
                tr.appendChild(td16);
                td17.appendChild(txt17);
                tr.appendChild(td17);
                td18.appendChild(txt18);
                tr.appendChild(td18);
                td19.appendChild(txt19);
                tr.appendChild(td19);
                td20.appendChild(txt20);
                tr.appendChild(td20);
                td21.appendChild(txt21);
                tr.appendChild(td21);
                td22.appendChild(txt22);
                tr.appendChild(td22);
                td23.appendChild(txt23);
                tr.appendChild(td23);
                td24.appendChild(txt24);
                tr.appendChild(td24);
                td25.appendChild(txt25);
                tr.appendChild(td25);
                td26.appendChild(txt26);
                tr.appendChild(td26);
                td27.appendChild(txt27);
                tr.appendChild(td27);
                td28.appendChild(txt28);
                tr.appendChild(td28);
                td29.appendChild(txt29);
                tr.appendChild(td29);
                td30.appendChild(txt30);
                tr.appendChild(td30);
                td31.appendChild(txt31);
                tr.appendChild(td31);
                td32.appendChild(txt32);
                tr.appendChild(td32);
                td33.appendChild(txt33);
                tr.appendChild(td33);
                td34.appendChild(txt34);
                tr.appendChild(td34);
                td35.appendChild(txt35);
                tr.appendChild(td35);
                td36.appendChild(txt36);
                tr.appendChild(td36);
                td37.appendChild(txt37);
                tr.appendChild(td37);
                td38.appendChild(txt38);
                tr.appendChild(td38);
                td39.appendChild(txt39);
                tr.appendChild(td39);
                td40.appendChild(txt40);
                tr.appendChild(td40);
                /* tdBoton.appendChild(x);
                 tr.appendChild(tdBoton)*/
                $("#tblOpPre tbody").append(tr);
                cont = parseInt(cont) + 1;//genera num de filas

            }//ffor
            //$("#tblOPreocupante").css("display", "block");
            // TIPO DE REPORTE CLAVE DE  ENTIDAD FINANCIERA PERIODO PUNTO ÓRGANO SUPERVISOR
            var nombre = 3 + "088" + operacionP[i][1] + periodo + "." + "00" + operacionP[i][0];
            if (boton === 'csv') {
                csv('#tbPre', nombre);
            } else {
                Excel('#tblOpPre', nombre);
            }

        }
    });//ajax
}
/**
 * OPERACIONES INUSUALES
 * consultar operaciones x sucursal
 */
function opeInporSuc() {
    var suc = $("#sucId").val();
    var porcentaje = $("#porcent").val();
    var datos = [suc, porcentaje];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "opeinusual/movimientos",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            var datos = JSON.parse(retorno);
            for (var i in datos) {
                $('#tblOpInusu tbody').append('<tr></tr>');
                var row = $('#tblOpInusu tbody tr').last();
                for (var j in datos[i]) {
                    var objeto = datos[i][j];
                    console.log(objeto);
                    //row.style.dispaly='none';
                    row.append('<td>' + objeto + '</td>');
                }//forinterno
            }
        }
    });//ajax
}
function perfil() {
    var porcentaje= $("#porcentaje").val();
    $("#tableClientes tbody").on('click', 'tr', function () {
        var idT = $('td', this).eq(1).text();
        $("#idclPf").val(idT);
        var datos = [idT,porcentaje];

        $(document).ajaxSend(function (e, xhr, options) {
            var token = $("input[name='_csrf']").val();
            var cabecera = "X-CSRF-TOKEN";
            xhr.setRequestHeader(cabecera, token);
        });
        $.ajax({
            url: "cliente/perfil",
            data: {datos: datos},
            dataType: 'html',
            type: 'POST',
            success: function (cliente) {
                var mensajeModal;
                var datos = JSON.parse(cliente);
                
                if (datos.length === 0) {
                    mensajeModal = 'El cliente solo ha echo envios';
                    $.blockUI({css: {
                            border: 'none',
                            padding: '15px',
                            backgroundColor: '#000',
                            '-webkit-border-radius': '10px',
                            '-moz-border-radius': '10px',
                            opacity: .5,
                            color: '#fff'
                        }, message: mensajeModal});
                    setTimeout($.unblockUI, 2000);
                } else {
                    $("#divContCli").css("display", "none");
                    var num = 1;
                    for (var i in datos) {
                        document.getElementById('nameCom').innerHTML = datos[i][1];
                        document.getElementById("sexoC").innerHTML =datos[i][6];
                        document.getElementById("curp").innerHTML =datos[i][2];
                        document.getElementById("rcf").innerHTML =datos[i][3];
                        document.getElementById("tipIden").innerHTML =datos[i][4];
                        document.getElementById("fechNac").innerHTML =datos[i][5];
                        document.getElementById("calle").innerHTML =datos[i][13];
                        document.getElementById("colonia").innerHTML =datos[i][14];
                       
                        $('#tableMovimientos tbody').append('<tr></tr>');
                        var row = $('#tableMovimientos tbody tr').last();
                        row.append('<td>' + num + '</td>');
                        row.append('<td>' + datos[i][7] + '</td>');
                        row.append('<td>' + datos[i][1] + '</td>');
                        row.append('<td>' +"$"+ datos[i][8] + '</td>');
                        row.append('<td>' + datos[i][9] + '</td>');
                        row.append('<td>' + datos[i][11] + '</td>');
                        row.append('<td>' + datos[i][10] + '</td>');
                        row.append('<td>' + datos[i][12] + '</td>');
                        num++;
                    }//for
                    
                }//else
               //********************************
                var porcentaje= $("#porcentaje").val();
      var datos = [idT,porcentaje];
               $.ajax({
        url: "cliente/limite",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            var datos = JSON.parse(retorno); 
            for (var i in datos) {
                console.log(datos[i][0]+" "+datos[i][1]);
                        $("#perfilCal").val(datos[i][0]);
                        $("#total").val(datos[i][1]);
                    }
            $("#divPerfil").css("display", "block");
            
        }
    });//ajaxsegundapeticion
               //*********************************
            }, //retorno
            error: function (jqXHR, textStatus, errorThrown) {
                alert("Se ha producido un error en el servidor");
            }
        });//ajax
    });//tabla
}
function cambioPorcentaje() {
    var id=$("#idclPf").val();
    var porcentaje = $("#porcentaje").val();
    var datos = [id, porcentaje];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "cliente/limite",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            var datos = JSON.parse(retorno);
            var datos = JSON.parse(retorno); 
            for (var i in datos) {
                console.log(datos[i][0]+" "+datos[i][1]);
                        $("#perfilCal").val(datos[i][0]);
                        $("#total").val(datos[i][1]);
                    }
        }
    });//ajax
}
function verPerfil() {
    $("#divPerfil").css("display", "none");
    $("#divContCli").css("display", "block");
    $("#pantalla").load("cliente");
}
 