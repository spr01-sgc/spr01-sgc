jQuery.fn.tableToCSV = function(nombre,file) {
    if(file==='excel'){
    var clean_text = function(text){
        var part=text.substring(0,1);
        if(part==='0'){
            return '"'+text+'"';
        }else {// text = text.replace(/"/g, '""');
        return ''+text+'';
    }
    };
}else{
    var clean_text = function(text){
        return ''+text+'';
    };
}
    
	$(this).each(function(){
			var table = $(this);
			var caption = $(this).find('caption').text();
			var title = [];
			var rows = [];
                        console.log('caption tine'+caption);

			$(this).find('tr').each(function(){
				var data = [];
				$(this).find('th').each(function(){
                    var text = clean_text($(this).text());
					title.push(text);
					});
				$(this).find('td').each(function(){
                    var text = clean_text($(this).text());
					data.push(text);
					});
				data = data.join(";");
				rows.push(data);
				});
			title = title.join(";");
			rows = rows.join("\r\n");

			var csv = title + rows;//application/vnd.ms-excel,,
			var uri = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
			var download_link = document.createElement('a');
			download_link.href = uri;
			var ts = new Date().getTime();
			if(nombre===""){
				download_link.download = ts+".csv";
			} else {
				download_link.download = nombre+".csv";
			}
			document.body.appendChild(download_link);
			download_link.click();
			document.body.removeChild(download_link);
	});
    
};
