/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package com.soma.transmisor.dao.impl.auxiliar;

import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import com.soma.transmisor.dao.auxiliar.BitacoraUsuarioDaoAux;
import com.soma.transmisor.model.Accion;
import com.soma.transmisor.model.BitaAccionesUsuario;
import com.soma.transmisor.model.Usuario;
import com.soma.transmisor.service.AccionService;
import com.soma.transmisor.service.BitaAccionesUsuarioService;
import com.soma.transmisor.service.UsuarioService;
import java.util.Date;
import java.util.Iterator;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import org.springframework.beans.factory.annotation.Autowired;

/**
 *
 * @author JASMIN-SOMA
 */
@Service("bitacoraUsuarioDaoAux")
@Transactional
public class BitacoraUsuarioDaoImplAux implements BitacoraUsuarioDaoAux {

    @Autowired
    UsuarioService usuarioService;
    @Autowired
    BitaAccionesUsuarioService bitaAccionesUsuarioService;
    @Autowired
    AccionService accionService;

    @Override
    public void bitacoraUsuario(String metodo, String user, boolean userAnonimo) {
    if (!userAnonimo) {
            BitaAccionesUsuario bitaAcc = new BitaAccionesUsuario();
            Date fechaHora = new Date();
            //Trae el usuario que ha inciado sesion

            Usuario usuarioid = usuarioService.busquedaNinckname(user);
            //del usuario se trae el id
            usuarioid.getUsuarioid();
            Accion accion=null;
            List<Accion> lAcciones=accionService.showAcciones();
            Iterator iterator = lAcciones.iterator();
        while (iterator.hasNext()&& accion==null) {
           Accion accionid = (Accion) iterator.next();
            Logger.getLogger("Accion id ").log(Level.INFO, "Tiene: "+ accionid);
            if(metodo.equals(accionid.getDescripcion())){
                accion  = accionService.buscaId(accionid.getAccionid());
                   accion.getAccionid();//se pasa a bitacoraUsuario
            }
    }
            
         
            bitaAcc.setUsuario(usuarioid);
            bitaAcc.setFechaHora(fechaHora);
            bitaAcc.setAccion(accion);
            if (bitaAccionesUsuarioService.save(bitaAcc)) {
                
            } else {
                //return "error";
            }
        }
     
    }

}
