$(document).ready(function () {
    var pathname = window.location.pathname;
    if (pathname === "/Transmisor/envios") {
        informacionQuienEnvia();
        color_div_paso_1();
    }
    if (pathname === "/Transmisor/pago") {
        $('#frmBuscaRemesaModal').modal();
        $('#btnAtrasPagar').css("display", "none");
    }
    $("#personafisica").attr('checked', true);
});

function cancelaBuscaRemesa() {
    window.location.href = "/Transmisor/";
}

function regresaPaginaPrincipal() {
    var pathname = window.location.pathname;
    window.location.href = pathname.substr(0, 12);
}

function imprimirTicket() {
    alert("Imprimiendo ticket");
}

function color_div_paso_1() {
    $("#paso1").css("background-color", "#4CB630");
    $("#paso1").css("color", "#ffffff");
}
function color_div_paso_2() {
    $("#paso2").css("background-color", "#4CB630");
    $("#paso2").css("color", "#ffffff");
}
function color_div_paso_3_anterior() {
    $("#paso3").css("background-color", "#ffffff");
    $("#paso3").css("color", "#000000");
}
function color_div_paso_2_anterior() {
    $("#paso2").css("background-color", "#ffffff");
    $("#paso2").css("color", "#000000");
}
function color_div_paso_3() {
    $("#paso3").css("background-color", "#4CB630");
    $("#paso3").css("color", "#ffffff");
}
function color_div_paso_4() {
    $("#paso4").css("background-color", "#4CB630");
    $("#paso4").css("color", "#ffffff");
}

function validaPersonaFisica() {
    if ($("#nombrepersonafisica").val() !== "" && $("#apaternofisica").val() !== ""
            && $("#amaternofisica").val() !== "" && $("#curpfisica").val() !== ""
            && $("#sexofisica").val() !== "0" && $("#fechanacimiento").val() !== ""
            && $("#noidentificacion").val() !== "" && $("#tipoIdentificacion").val() !== "0"
            && $("#statusIdentificacion").val() !== "0" && $("#actividad").val() !== "0"
            && $("#callefisica").val() !== "" && $("#coloniafisica").val() !== ""
            && $("#codigopostalfisica").val() !== "0" && $("#ciudad").val() !== "0"
            && $("#estado").val() !== "0" && $("#telefonofisica").val() !== ""
            && $("#tipoTelefonofisica").val() !== "0") {
        if ($("#nombrepersonafisica").val().length <= 50) {
            if ($("#apaternofisica").val().length <= 50) {
                if ($("#amaternofisica").val().length <= 50) {
                    if (validarCURP($("#curpfisica").val()) !== false) {
                        if (validaRFCFisica($("#rfcfisica").val()) !== false) {
                            if ($("#noidentificacion").val().length <= 50) {
                                if ($("#callefisica").val().length <= 50) {
                                    if ($("#coloniafisica").val().length <= 50) {
                                        if (validarTelefono("#telefonofisica", $("#telefonofisica").val()) !== false) {
                                            if ($("#emailfisica").val() === "") {
                                                return true;
                                            } else {
                                                if (validarEmail($("#emailfisica").val()) !== false) {
                                                    return true;
                                                }else{
                                                    return false;
                                                }
                                            }
                                        } else {
                                            return false;
                                        }
                                    } else {
                                        error("La colonia excede los 50 caracteres");
                                        return false;
                                    }
                                } else {
                                    error("La direcci&oacute;n excede los 50 caracteres");
                                    return false;
                                }
                            } else {
                                error("El n&uacute;mero de identificaci&oacute;n excede los 50 digitos");
                                return false;
                            }
                        } else {
                            return false;
                        }
                    } else {
                        return false;
                    }
                } else {
                    error("El tama&ntilde;o m&aacute;ximo del apellido materno es de 50 caracteres");
                    return false;
                }
            } else {
                error("El tama&ntilde;o m&aacute;ximo del apellido paterno es de 50 caracteres");
                return false;
            }
        } else {
            error("El tama&ntilde;o m&aacute;ximo del nombre es de 50 caracteres");
            return false;
        }
    } else {
        error("Debes llenar los campos requeridos.");
        return false;
    }
}

function pagarRemesa() {
    if (validaPersonaFisica() !== false) {
        if ($("#instrumentoMonetario").val() !== "0") {
            if ($("#tipoServicio").val() !== "0") {
                if ($("#usoDinero").val() !== "0") {
                    if ($("#parentesco").val() !== "0") {
                        //Datos del beneficiario cliente
                        var clavePersonaFisica = $("#clavePersonaFisica").val();
                        var nombrepersonafisica = $("#nombrepersonafisica").val();
                        var apaternofisica = $("#apaternofisica").val();
                        var amaternofisica = $("#amaternofisica").val();
                        var curpfisica = $("#curpfisica").val();
                        var sexofisica = $("#sexofisica").val();
                        var fechanacimiento = $("#fechanacimiento").val();
                        var noidentificacion = $("#noidentificacion").val();
                        var tipoIdentificacion = $("#tipoIdentificacion").val();
                        var identificacionSt = $("#statusIdentificacion").val();
                        var actividad = $("#actividad").val();
                        var emailfisica = $("#emailfisica").val();
                        var rfcfisica = $("#rfcfisica").val();
                        var callefisica = $("#callefisica").val();
                        var coloniafisica = $("#coloniafisica").val();
                        var codigopostal = $("#codigopostalfisica").val();
                        var telefonofisica = $("#telefonofisica").val();
                        var tipoTelefonofisica = $("#tipoTelefonofisica").val();

                        var instrumentoMonetario = $("#instrumentoMonetario").val();
                        var tipoServicio = $("#tipoServicio").val();
                        var cveRemesa = $("#cveRemesa").val();

                        var causaRechazoId = $("#causaRechazoId").val();

                        var usoDinero = $("#usoDinero").val();
                        var parentesco = $("#parentesco").val();
                        $(document).ajaxSend(function (e, xhr, options) {
                            var token = $("input[name='_csrf']").val();
                            var cabecera = "X-CSRF-TOKEN";
                            xhr.setRequestHeader(cabecera, token);
                        });
                        var datos = [clavePersonaFisica, nombrepersonafisica, amaternofisica,
                            apaternofisica, curpfisica, sexofisica,
                            fechanacimiento, noidentificacion, tipoIdentificacion,
                            identificacionSt, actividad, emailfisica,
                            rfcfisica, callefisica, coloniafisica,
                            codigopostal, telefonofisica, tipoTelefonofisica,
                            instrumentoMonetario, tipoServicio, cveRemesa,
                            causaRechazoId, usoDinero, parentesco];

                        var mensajeModal = "Realizando Transacci&oacute;n";
                        blockUI(mensajeModal);
                        $.ajax({
                            url: "pago/pagarRemesa",
                            data: {datos: datos},
                            dataType: 'html',
                            type: 'POST',
                            success: function (data) {
                                var datosRemesa = JSON.parse(data);
                                $("#divpersonafisica").css("display", "none");
                                $("#infoRemesa").css("display", "block");
                                color_div_paso_3();
                                if (datosRemesa[0] === "error") {
                                    error("Error al pagar la remesa");
                                    unBlockUI(800);
                                } else if (datosRemesa[0] === "Cancelado") {
                                    window.location.href = "pago";
                                    ok("Remesa Cancelada");
                                } else if (datosRemesa[10] === "Pagada") {
                                    document.getElementById('infoClaveRemesa').innerHTML = datosRemesa[0];
                                    document.getElementById('infoNombreBeneficiario').innerHTML = datosRemesa[1];
                                    document.getElementById('infoApellidosBeneficiario').innerHTML = datosRemesa[2] + " " + datosRemesa[3];
                                    document.getElementById('infoTelefonoBeneficiario').innerHTML = datosRemesa[4];
                                    document.getElementById('infoMontoRemesa').innerHTML = datosRemesa[5];
                                    document.getElementById('infoNombreRemitente').innerHTML = datosRemesa[6];
                                    document.getElementById('infoApellidosRemitente').innerHTML = datosRemesa[7] + " " + datosRemesa[8];
                                    document.getElementById('infoTelefonoRemitente').innerHTML = datosRemesa[9];
                                    ok("Remesa Pagada");
                                    unBlockUI(800);
                                }
                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                alert("Se ha producido un error en el servidor");
                            }
                        });
                    } else {
                        error("Selecciona el parentesco");
                    }
                } else {
                    error("Selecciona el Uso del Dinero");
                }

            } else {
                error("Selecciona el tipo de servicio");
            }
        } else {
            error("Selecciona el instrumento monetario");
        }
    }
}

function blockUI(mensaje) {
    $.blockUI({css: {
            border: 'none',
            padding: '15px',
            backgroundColor: '#000',
            '-webkit-border-radius': '10px',
            '-moz-border-radius': '10px',
            opacity: .5,
            color: '#fff'
        }, message: mensaje});
}

function unBlockUI(time) {
    setTimeout($.unblockUI, time);
}

function habilitaBtnPago() {
    var pathname = window.location.pathname;
    if (pathname === "/Transmisor/pago") {
        if ($("#validacion").is(':checked')) {
            $('#btnPagarRemesa').attr("disabled", false);
        } else {
            $('#btnPagarRemesa').attr("disabled", true);
        }
    } else {
        if ($("#validacion").is(':checked')) {
            $('#btnRegistraEnvio').attr("disabled", false);
        } else {
            $('#btnRegistraEnvio').attr("disabled", true);
        }
    }
}

function atrasPagar() {
    $('#infoValidar').css("display", "none");
    $('#infoEstaticaRemitente').css("display", "none");
    $('#btnAtrasPagar').css("display", "none");
    $('#datosBeneRemitente').css("display", "block");
    color_div_paso_2();
    $('#btnPagarRemesa').attr("disabled", true);
    buscarOtroCliente();
}

function cerrarModal() {
    $(".modal").hide();
    $('body').removeClass('modal-open');//eliminamos la clase del body para poder hacer scroll
    $('.modal-backdrop').remove();//eliminamos el backdrop del modal
}

/**
 * Funcion que me permite buscar una remesa 
 * @returns {undefined}
 */
function buscaRemesa() {
    if ($('#cveRemesa').val() !== "") {
        if ($('#cveRemesa').val().length <= 50) {
            var datos;
            var cveRemesa = $('#cveRemesa').val();
            $(document).ajaxSend(function (e, xhr, options) {
                var token = $("input[name='_csrf']").val();
                var cabecera = "X-CSRF-TOKEN";
                xhr.setRequestHeader(cabecera, token);
            });
            if (cveRemesa === "") {
                $("#cveRemesa").animate({marginTop: "#FC152A"});
            }
            datos = cveRemesa;
            var mensajeModal = "Validando clave...";
            blockUI(mensajeModal);
            $.ajax({
                url: "pago/buscaRemesa",
                data: {datos: datos},
                dataType: 'html',
                type: 'POST',
                success: function (data) {
                    var datosRemesa = JSON.parse(data);
                    if (datosRemesa[15] === "Enviado") {
                        $('#btnRemiBene').attr("disabled", true);
                        $('#mensajeBusquedaRemesa').css("display", "none");
                        document.getElementById('clave').innerHTML = datosRemesa[0];
                        document.getElementById('monto').innerHTML = datosRemesa[1];
                        document.getElementById('nomRemitente').innerHTML = datosRemesa[2];
                        document.getElementById('apellidosRemitente').innerHTML = datosRemesa[3] + " " + datosRemesa[4];
                        document.getElementById('dirRemitente').innerHTML = datosRemesa[5];
                        document.getElementById('colRemitente').innerHTML = datosRemesa[6];
                        document.getElementById('estadoRemitente').innerHTML = datosRemesa[7];
                        document.getElementById('muniRemitente').innerHTML = datosRemesa[8];
                        document.getElementById('cpRemitente').innerHTML = datosRemesa[9];
                        document.getElementById('telRemitente').innerHTML = datosRemesa[10];
                        document.getElementById('nomBeneficario').innerHTML = datosRemesa[11];
                        document.getElementById('apellidosBeneficario').innerHTML = datosRemesa[12] + " " + datosRemesa[13];
                        document.getElementById('telBeneficario').innerHTML = datosRemesa[14];
                        $('#validacionRemesa').css("display", "none");
                        $('#datosBeneRemitente').css("display", "block");
                        $('#pasos').css("display", "block");
                        color_div_paso_1();
                        $('#divpersonafisica').css("display", "block");
                        $('#divBuscaPersonaIdentificacion').css("display", "block");
                        $('#frmBuscaRemesaModal').modal('hide');
                        unBlockUI(800);
                        ok("Clave encontrada");
                    } else if (datosRemesa[0] === "Pagada") {
                        unBlockUI(300);
                        error("Esta Remesa ya ha sido pagada");
                    } else if (datosRemesa[0] === "Cancelada") {
                        unBlockUI(300);
                        error("Esta Remesa ha sido cancelada");
                    } else if (datosRemesa[0] === "Rechazada") {
                        unBlockUI(300);
                        error("Esta Remesa ha rechazada");
                    } else {
                        var mensaje = "NO EXISTE LA CLAVE DE LA REMESA.<br/>\n\
                               POR FAVOR VERIFIQUE QUE ESTE CORRECTA.";
                        $('#mensajeBusquedaRemesa').css("display", "block");
                        document.getElementById('mensajeBusquedaInfo').innerHTML = mensaje;
                        unBlockUI(500);
                        error("No se ha encontrado la clave");
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert("Se ha producido un error en el servidor");
                }
            });
        } else {
            error("EL rango de la clave es incorrecto");
        }
    } else {
        error("Inserta una clave");
    }
}

//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
///////////// FUNCIONES PARA UN ENVIO ////////////////////////////

function siguienteDatosCompletos() {
    $("#datosRemesadoraPaga").css("display", "none");
    $("#datosFinalesEnvio").css("display", "block");
}

function atrasRemesadoraPaga() {
    $("#datosRemesadoraPaga").css("display", "block");
    $("#datosFinalesEnvio").css("display", "none");
    color_div_paso_3_anterior();

}

function datosEnvioFinales() {
    if ($("#destino").val() !== "0") {
        $("#datosRemesadoraPaga").css("display", "none");
        $("#datosFinalesEnvio").css("display", "block");
        var nombreRemitente = $("#nombrepersonafisica").val();
        var apellidosRemitente = $("#apaternofisica").val() + " " + $("#amaternofisica").val();
        var direccionRemitente = $("#callefisica").val();
        var coloniaRemitente = $("#coloniafisica").val();
        var cpRemitente = $("#codigopostalfisica").val();
        var telRemitente = $("#telefonofisica").val();

        var nombreBeneficario = $("#nombrebene").val();
        var apellidos = $("#apaternobene").val() + " " + $("#amaternobene").val();
        var telefono = $("#telBeneficiario").val();

        var destino = $("#destino").val();
        var monto = $("#cantidadenviada").val();
        var comision = $("#comisionPago").val();
        var total = parseInt(monto) + parseInt(comision);

        $(document).ajaxSend(function (e, xhr, options) {
            var token = $("input[name='_csrf']").val();
            var cabecera = "X-CSRF-TOKEN";
            xhr.setRequestHeader(cabecera, token);
        });
        var datos = [cpRemitente, destino];
        $.ajax({
            url: "envios/datosEnvioFinales",
            data: {datos: datos},
            dataType: 'html',
            type: 'POST',
            success: function (data) {
                var valor = JSON.parse(data);
                document.getElementById('nombreRemitente').innerHTML = nombreRemitente;
                document.getElementById('apelldiosRemitente').innerHTML = apellidosRemitente;
                document.getElementById('direccionRemitente').innerHTML = direccionRemitente;
                document.getElementById('coloniaRemitente').innerHTML = coloniaRemitente;
                document.getElementById('ciudadRemitente').innerHTML = valor[0];
                document.getElementById('estadoRemitente2').innerHTML = valor[1];
                document.getElementById('paisRemitente').innerHTML = valor[2];
                document.getElementById('telefonoRemitente').innerHTML = telRemitente;
                document.getElementById('montoPago').innerHTML = monto;
                document.getElementById('comisionPago2').innerHTML = comision;
                document.getElementById('totalPago').innerHTML = total;
                document.getElementById('nombreBeneficario').innerHTML = nombreBeneficario;
                document.getElementById('apellidosBene').innerHTML = apellidos;
                document.getElementById('telefonoBene').innerHTML = telefono;
                document.getElementById('destinoPago').innerHTML = valor[3];
                color_div_paso_3();

            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert("Se ha producido un error en el servidor");
            }
        });
    } else {
        error("Selecciona un destino");
    }
}

function calculaCargos() {
    if ($("#comisionPago").val() !== "" && $("#cantidadenviada").val() !== ""
            && $("#tipomoneda").val() !== "0") {
        if ($("#cantidadenviada").val().length <= 10) {
            if ($("#comisionPago").val().length <= 10) {
                var monto = $("#cantidadenviada").val();
                var comision = $("#comisionPago").val();
                var tipoMoneda = $("#tipomoneda").val();
                var total;
                $(document).ajaxSend(function (e, xhr, options) {
                    var token = $("input[name='_csrf']").val();
                    var cabecera = "X-CSRF-TOKEN";
                    xhr.setRequestHeader(cabecera, token);
                });
                var datos = tipoMoneda;
                var mensajeModal = "Calculando cargos...";
                blockUI(mensajeModal);
                $.ajax({
                    url: "envios/calculaCargos",
                    data: {datos: datos},
                    dataType: 'html',
                    type: 'POST',
                    success: function (data) {
                        $("#datosCobroDiv").css("display", "block");
                        total = parseInt(monto) + parseInt(comision);
                        document.getElementById('idMonto').innerHTML = monto;
                        document.getElementById('idComision').innerHTML = comision;
                        document.getElementById('idTotal').innerHTML = total;
                        document.getElementById('idTipoMoneda').innerHTML = data;
                        $('#btnDatosRemesa').attr("disabled", false);
                        unBlockUI(300);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert("Se ha producido un error en el servidor");
                    }
                });
            } else {
                error("La longitud del campo de la comisi&oacute;n debe ser menor o igual a 10 digitos");
            }
        } else {
            error("La cantidad m&aacute;xima a enviar debe ser menor o igual a 10 digitos");
        }
    } else {
        error("Debes llenar los campos requeridos.");
    }
}

function datosRemesadoraPagadora() {
    var datos;
    var destino = $('#destino').val();
    $('#tbodyRemesadoras').empty();
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    var datos = destino;
    var mensajeModal = "Buscando remesadoras";
    blockUI(mensajeModal);
    $.ajax({
        url: "envios/datosRemesadoraPagadora",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (data) {
            var datossucursal = JSON.parse(data);
            $('#tblRemesadorasPagadoras').css("display", "block");
            var cont = 1;
            for (var l in datossucursal) {
                $('#tablaRemesadorasPagadoras tbody').append('<tr></tr>');
                var row = $('#tablaRemesadorasPagadoras tbody tr').last();
                row.append('<td>' + cont + '</td>');
                row.append('<td>' + datossucursal[l].nombresucursal + '</td>');
                row.append('<td>' + datossucursal[l].direccionid.calle + '</td>');
                row.append('<td>' + datossucursal[l].direccionid.colonia + '</td>');
                row.append('<td>' + datossucursal[l].direccionid.codigopostalid.ciudad.nombre + '</td>');
                row.append('<td>' + datossucursal[l].correoelectronico + '</td>');
                cont = cont + 1;
            }
            unBlockUI(400);
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}

function datosRemesarodaPaga() {
    if ($("#nombrebene").val() !== "" && $("#apaternobene").val() !== ""
            && $("#amaternobene").val() !== "" && $("#sexobene").val() !== "0"
            && $("#telBeneficiario").val() !== "" && $("#tipoTelBeneficiario").val() !== "0") {
        if ($("#nombrebene").val().length <= 50) {
            if ($("#apaternobene").val().length <= 50) {
                if ($("#amaternobene").val().length <= 50) {
                    if (validarTelefono("#telBeneficiario", $("#telBeneficiario").val()) !== false) {
                        $('#beneficiario').css("display", "none");
                        $('#datosRemesadoraPaga').css("display", "block");
                    }
                } else {
                    error("El apellido materno excede los 50 caracteres");
                }
            } else {
                error("El apellido paterno excede los 50 caracteres");
            }
        } else {
            error("El nombre excede los 50  caracteres");
        }
    } else {
        error("Debes llenar los campos requeridos.");
    }
}
function datosAtrasBeneficiario() {
    $('#datosRemesadoraPaga').css("display", "none");
    $('#beneficiario').css("display", "block");
}
//function buscarCliente() {
//    if ($("#tipoBuscaPersona").val() === "0") {
//        $('#btnCliente').attr("disabled", true);
//    } else {
//        $('#btnCliente').attr("disabled", false);
//    }
//}

/**
 * Función que me permite convertir el texto a mayusculas
 * @param {type} e
 * @returns {undefined}
 */
function mayuscula(e) {
    e.value = e.value.toUpperCase();
}

function seleccionaBeneficiario(idBeneficiario) {
    var datos;
    var idBene;
    idBene = $("#" + idBeneficiario + "").parents("tr").find("td").eq(0).text();
    datos = [idBene];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "envios/seleccionaBeneficiario",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (data) {
            var datosBeneficiario = JSON.parse(data);
            $("#nombrebene").val(datosBeneficiario[0]);
            $("#apaternobene").val(datosBeneficiario[1]);
            $("#amaternobene").val(datosBeneficiario[2]);
            $("#sexobene").val(datosBeneficiario[3]);
            $('#telBeneficiario').val(datosBeneficiario[4]);
            $('#tipoTelBeneficiario').val(datosBeneficiario[5]);
            $('#idBeneficiario').val(datosBeneficiario[6]);
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}


function detectaCambioCombo(busqueda) {
    var cp = $("#codigopostalfisica").val();
    var ciudad = $("#ciudad").val();
    var estado = $("#estado").val();
    var datos;
    var filtro;
    if (busqueda === "cp") {
        filtro = "codigoPostal";
        datos = [cp, filtro];
    } else if (busqueda === "ciudad") {
        filtro = "ciudad";
        datos = [ciudad, filtro];
    } else if (busqueda === "estado") {
        filtro = "estado";
        datos = [estado, filtro];
    }
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "envios/detectaCambioCombo",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (data) {
            //var datosPersona = JSON.parse(data);

        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}

function listaBeneficiarios(idCliente) {
    var datos;
    datos = idCliente;
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "envios/listaBeneficiarios",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (data) {
            var datosPersona = JSON.parse(data);
            for (var i in datosPersona) {
                $('#tablaBeneficiarios tbody').append('<tr></tr>');
                var row = $('#tablaBeneficiarios tbody tr').last();
                var NA = "N/A";
                for (var j in datosPersona[i]) {
                    var objeto = datosPersona[i][j];
                    if (j === "0" && objeto !== null) {
                        row.append('<td id = "idIdenBene' + i + '">' + objeto + '</td>');
                    } else if (j === "4" && objeto === null) {
                        row.append('<td>' + NA + '</td>');
                    } else if (j !== "0") {
                        row.append('<td>' + objeto + '</td>');
                    }
                    if (j === "4") {
                        row.append('<td><input type="button" value="Seleccionar" class="estilobtn gris" onclick="seleccionaBeneficiario(' + "'idIdenBene" + i + "'" + ');"></td>');
                    }
                }//forinterno
            }

        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}

function buscaCliente() {
    if ($("#buscaPersona").val() !== "" && $("#tipoBuscaPersona").val() !== "0") {
        var valor = $("#tipoBuscaPersona").val();
        var filtro;
        $('#buscaPersona').prop('disabled', true);
        $('#tipoBuscaPersona').prop('disabled', true);
        $('#buscaOtroClienteF').css("display", "block");

        var mensaje = "Debe de insertar el n&uacute;mero de identificaci&oacute;n!!";
        if ($('#buscaPersona').val() !== "") {
            if (valor === "1") {
                filtro = "clavePersonaFisica";
                detectaCambio(filtro);
            } else if (valor === "2") {
                filtro = "noidentificacion";
                detectaCambio(filtro);
            } else if (valor === "3") {
                filtro = "curpfisica";
                detectaCambio(filtro);
            } else if (valor === "4") {
                filtro = "rfcfisica";
                detectaCambio(filtro);
            }
        } else {
            $('#editInfo').css("display", "none");
            document.getElementById('mensajeBusquedaInfo').innerHTML = mensaje;
            $('#mensajeBusqueda').css("display", "block");
        }
    } else {
        error("Debes llenar los campos requeridos.");
    }
}

function informacionQuienEnvia() {
    var datos;
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    datos = 1;
    var mensajeModal = "Cargando p&aacute;gina...";
    blockUI(mensajeModal);
    $.ajax({
        url: "envios/informacionQuienEnvia",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (data) {
            var datosQuienEnvia = JSON.parse(data);
            var date = new Date();
            var mes = ["01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"];
            document.getElementById('nombreSucursalEnvia').innerHTML = datosQuienEnvia[0];
            document.getElementById('ciudadOrigen').innerHTML = datosQuienEnvia[1];
            document.getElementById('estadoOrigen').innerHTML = datosQuienEnvia[2];
            document.getElementById('paisOrigen').innerHTML = datosQuienEnvia[3];
            document.getElementById('fecha').innerHTML = date.getDate() + '/' + mes[date.getMonth()] + '/' + date.getFullYear();
            unBlockUI(800);
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}

/**
 * 
 * @returns {undefined}
 */
function buscarOtroCliente() {
    limpiaCajaFisica();
    $('#buscaPersona').val("");
    $('#tipoBuscaPersona').val(0);
    $('#buscaPersona').prop('disabled', false);
    $('#tipoBuscaPersona').prop('disabled', false);
    $("#clavePersonaFisica").prop('disabled', false);
    $('#infoRemitente').css("display", "none");
    $('#infoEstaticaRemitente').css("display", "none");
    $("#buscaOtroClienteF").css("display", "none");
    $('#ocultaInfo').css("display", "none");
    $('#editInfo').css("display", "block");
    $('#nombreFisica').val("");
    $('#curpFis').val("");
    $('#identificacionNo').val("");
    $('#mensajeBusqueda').css("display", "none");
    var pathname = window.location.pathname;
    if (pathname === "/Transmisor/pago") {
        $('#btnAtrasPagar').css("display", "none");
        $('#infoValidar').css("display", "none");
        $('#datosBeneRemitente').css("display", "block");
        color_div_paso_2();
    }
}

/*
 * Función que permite limpiar las cajas de texto de la persona física 
 * @returns {undefined}
 */
function limpiaCajaFisica() {
    $('#noidentificacion').val("");
    document.getElementById('clavePersonaFisica').innerHTML = "";
    $('#nombrepersonafisica').val("");
    $('#apaternofisica').val("");
    $('#amaternofisica').val("");
    $('#curpfisica').val("");
    $('#sexofisica').val(0);
    $('#fechanacimiento').val("");
    $('#tipoIdentificacion').val(0);
    $('#statusIdentificacion').val(0);
    $('#actividad').val(0);
    $('#emailfisica').val("");
    $('#rfcfisica').val("");
    $('#callefisica').val("");
    $('#coloniafisica').val("");
    $('#codigopostalfisica').val(0);
    $('#clavePersonaFisica').val("");
    $('#telefonofisica').val("");
    $('#tipoTelefonofisica').val(0);
}

/*
 * Función que permite limpiar las cajas de texto de una persona moral
 * @returns {undefined}
 */
function limpiaCajaMoral() {
    $('#noClienteMoral').val("");
    $('#nombremoral').val("");
    $('#apaternomoral').val("");
    $('#amaternomoral').val("");
    $('#curpmoral').val("");
    $('#sexomoral').val(0);
    $('#emailmoral').val("");
    $('#rfcmoral').val("");
    $('#callemoral').val("");
    $('#coloniamoral').val("");
    $('#cpmoral').val(0);
    $('#razonsocial').val();
    $('#fechaConstitucion').val("");
    $('#nofirmaavanzada').val("");
    $('#giroC').val(0);
}

function editarInformacion() {
    $('#editInfo').css("display", "none");
    $('#ocultaInfo').css("display", "block");
    $('#infoRemitente').css("display", "block");
    $('#infoEstaticaRemitente').css("display", "none");
}

function ocultarInformacion() {
    $('#editInfo').css("display", "block");
    $('#ocultaInfo').css("display", "none");
    $('#infoRemitente').css("display", "none");
    $('#infoEstaticaRemitente').css("display", "block");
}

/**
 * Esta función me permite traer los datos de un cliente en caso de que este
 * ya se encuentre registrado en el sistema, para ello recibe paramétros de 
 * búsqueda como la clave/número de cuenta, CURP, Número de identificación
 * oficial o RFC.
 * @param {type} filtro
 * @returns {undefined}
 */
function detectaCambio(filtro) {
    var datos;
    var mensajeModal;
    if (filtro === 'clavePersonaFisica') {
        var clavePersonaFisica;
        if ($("#clavePersonaFisica").val() !== "") {
            clavePersonaFisica = $("#clavePersonaFisica").val();
        } else {
            clavePersonaFisica = $("#buscaPersona").val();
        }
        datos = [filtro, clavePersonaFisica];
        mensajeModal = 'Verificando clave del cliente...';
    } else if (filtro === 'curpfisica') {
        var curpfisica;
        if ($("#curpfisica").val() !== "") {
            curpfisica = $("#curpfisica").val();
        } else {
            curpfisica = $("#buscaPersona").val();
        }
        datos = [filtro, curpfisica];
        mensajeModal = 'Verificando CURP...';
    } else if (filtro === 'rfcfisica') {
        var rfcfisica;
        if ($("#rfcfisica").val() !== "") {
            rfcfisica = $("#rfcfisica").val();
        } else {
            rfcfisica = $("#buscaPersona").val();
        }
        datos = [filtro, rfcfisica];
        mensajeModal = 'Verificando RFC...';
    } else if (filtro === 'noidentificacion') {
        var noidentificacion;
        if ($("#noidentificacion").val() !== "") {
            noidentificacion = $("#noidentificacion").val();
        } else {
            noidentificacion = $("#buscaPersona").val();
        }
        datos = [filtro, noidentificacion];
        mensajeModal = 'Verificando número de idenficiación';
    }

    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    blockUI(mensajeModal);
    $.ajax({
        url: "envios/detectaCambio",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (data) {
            var datosPersona = JSON.parse(data);
            if (datosPersona[0] === "personaFisica") {
                $('#mensajeBusqueda').css("display", "none");
                if ($('#personafisica').prop('checked')) {
                    // var opcion = confirm("Ya existe un usuario con esos datos, ¿Desea mostrar la informaci&oacuten?");
                    // if (opcion == true) {
                    $('#noidentificacion').val(datosPersona[16]);
                    document.getElementById('clavePersonaFisica').innerHTML = datosPersona[15];
                    $('#nombrepersonafisica').val(datosPersona[1]);
                    $('#apaternofisica').val(datosPersona[2]);
                    $('#amaternofisica').val(datosPersona[3]);
                    $('#curpfisica').val(datosPersona[4]);
                    $('#sexofisica').val(parseInt(datosPersona[5]));
                    $('#fechanacimiento').val(datosPersona[6]);
                    $('#tipoIdentificacion').val(parseInt(datosPersona[7]));
                    $('#statusIdentificacion').val(parseInt(datosPersona[8]));
                    $('#actividad').val(parseInt(datosPersona[9]));
                    $('#emailfisica').val(datosPersona[10]);
                    $('#rfcfisica').val(datosPersona[11]);
                    $('#callefisica').val(datosPersona[13]);
                    $('#coloniafisica').val(datosPersona[14]);
                    $('#codigopostalfisica').val(parseInt(datosPersona[12]));
                    $('#clavePersonaFisica').val(datosPersona[15]);
                    $('#emisora').val(datosPersona[17]);
                    $('#telefonofisica').val(datosPersona[18]);
                    $('#tipoTelefonofisica').val(parseInt(datosPersona[19]));
                    $('#ciudad').val(parseInt(datosPersona[24]));
                    $('#estado').val(parseInt(datosPersona[25]));
                    $("#clavePersonaFisica").prop('disabled', true);
                    $("#buscaOtroClienteF").css("display", "block");
                    $('#editarInformacion').css("display", "block");
                    $('#infoEstaticaRemitente').css("display", "block");
                    var nombreCompleto = datosPersona[1].concat(" ", datosPersona[2], " ", datosPersona[3]);
                    document.getElementById('idNombre').innerHTML = nombreCompleto;
                    document.getElementById('idCURP').innerHTML = datosPersona[4];
                    document.getElementById('idIdentificacion').innerHTML = datosPersona[16];

                    $("#btnDatosClienteRemitente").attr("disabled", false);
                    unBlockUI(500);
                    listaBeneficiarios(datosPersona[15]);
                } else {
                    $('#noidentificacion').val(datosPersona[16]);
                    document.getElementById('clavePersonaFisica').innerHTML = datosPersona[15];
                    $('#nombrepersonafisica').val(datosPersona[1]);
                    $('#apaternofisica').val(datosPersona[2]);
                    $('#amaternofisica').val(datosPersona[3]);
                    $('#curpfisica').val(datosPersona[4]);
                    $('#sexofisica').val(parseInt(datosPersona[5]));
                    $('#fechanacimiento').val(datosPersona[6]);
                    $('#tipoIdentificacion').val(parseInt(datosPersona[7]));
                    $('#statusIdentificacion').val(parseInt(datosPersona[8]));
                    $('#actividad').val(parseInt(datosPersona[9]));
                    $('#emailfisica').val(datosPersona[10]);
                    $('#rfcfisica').val(datosPersona[11]);
                    $('#callefisica').val(datosPersona[13]);
                    $('#coloniafisica').val(datosPersona[14]);
                    $('#codigopostalfisica').val(parseInt(datosPersona[12]));
                    $('#clavePersonaFisica').val(datosPersona[15]);
                    $('#emisora').val(datosPersona[17]);
                    $('#telefonofisica').val(datosPersona[18]);
                    $('#tipoTelefonofisica').val(parseInt(datosPersona[19]));
                    $('#ciudad').val(parseInt(datosPersona[24]));
                    $('#estado').val(parseInt(datosPersona[25]));
                    $("#clavePersonaFisica").prop('disabled', true);
                    $("#buscaOtroClienteF").css("display", "block");
                    $('#editarInformacion').css("display", "block");
                    $('#infoEstaticaRemitente').css("display", "block");

                    var nombreCompleto = datosPersona[1].concat(" ", datosPersona[2], " ", datosPersona[3]);
                    document.getElementById('nombreFisica').innerHTML = nombreCompleto;
                    document.getElementById('curpFis').innerHTML = datosPersona[4];
                    document.getElementById('identificacionNo').innerHTML = datosPersona[16];
                    document.getElementById('tipo').innerHTML = datosPersona[23];
                    document.getElementById('dirBeneficiario').innerHTML = datosPersona[13];
                    document.getElementById('colBeneficiario').innerHTML = datosPersona[14];
                    document.getElementById('estBeneficiario').innerHTML = datosPersona[21];
                    document.getElementById('ciuBeneficiario').innerHTML = datosPersona[20];
                    document.getElementById('telefonoBeneficiario').innerHTML = datosPersona[18];

                    var pathname = window.location.pathname;
                    if (pathname === "/Transmisor/pago") {
                        color_div_paso_2();
                        $('#datosBeneRemitente').css("display", "none");
                        $('#infoValidar').css("display", "block");
                        $('#btnAtrasPagar').css("display", "block");
                        $('#lbl1').css("display", "none");
                        $('#lbl2').css("display", "block");
                    }
                    unBlockUI(100);
                }
            } else if (datosPersona[0] === "soloPersona") {
                $('#mensajeBusqueda').css("display", "none");
                if ($('#personafisica').prop('checked')) {
                    $('#nombrepersonafisica').val(datosPersona[1]);
                    $('#apaternofisica').val(datosPersona[2]);
                    $('#amaternofisica').val(datosPersona[3]);
                    $('#curpfisica').val(datosPersona[4]);
                    $('#sexofisica').val(parseInt(datosPersona[5]));
                    $("#noClienteMoral").prop('disabled', true);
                    $("#buscaOtroClienteM").css("display", "block");
                    unBlockUI(500);
                } else {
                    unBlockUI(100);
                }
            } else {
                var mensaje = "NO EXISTE REGISTRO DEL REMITENTE CON LOS DATOS PROPORCIONADOS.<br/>\n\
                                POR FAVOR VERIFIQUE, COMPLETE Y REGISTRE LOS DATOS DE LA PERSONA.";
                var pathname = window.location.pathname;
                if (pathname === "/Transmisor/pago") {
                    color_div_paso_2();
                    $('#datosBeneRemitente').css("display", "none");
                    $('#infoValidar').css("display", "block");
                    $('#btnAtrasPagar').css("display", "block");
                }
                $('#mensajeBusqueda').css("display", "block");
                $('#editInfo').css("display", "none");
                $("#btnDatosClienteRemitente").attr("disabled", false);
//                document.getElementById('mensajeBusquedaError').innerHTML = mensaje;
                error("NO EXISTE REGISTRO DEL REMITENTE, POR FAVOR LLENE EL FORMULARIO  ");
                $('#infoRemitente').css("display", "block");
                unBlockUI(100);
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}


/**
 * Función que me permite guardar un envió
 * @returns {undefined}
 */
function registrarEnvio() {

    var cantidadenviada = $("#cantidadenviada").val();
    var tipomoneda = $("#tipomoneda").val();
    // var valormoneda = $("#valormoneda").val();
    var valormoneda = "17";
    var instrumentomonetario = $("#instrumentomonetario").val();
    var tiposervicio = $("#tiposervicio").val();
    //Datos de Beneficiario
    var nombrebene = $("#nombrebene").val();
    var apaternobene = $("#apaternobene").val();
    var amaternobene = $("#amaternobene").val();
    //var cveIdentBeneficiario = $("#cveIdentBeneficiario").val();
    var sexobene = $("#sexobene").val();
    var telBeneficiario = $('#telBeneficiario').val();
    var tipoTelBeneficiario = $('#tipoTelBeneficiario').val();
    var idBeneficiario = $('#idBeneficiario').val();

    var comisionPago = $("#comisionPago").val();
    var destino = $("#destino").val();
    var emisora = $("#emisora").val();

    //Datos del tipo de persona que envía 
    //Datos en caso de que la persona sea fisica
    var clavePersonaFisica = $("#clavePersonaFisica").val();
    var nombrepersonafisica = $("#nombrepersonafisica").val();
    var apaternofisica = $("#apaternofisica").val();
    var amaternofisica = $("#amaternofisica").val();
    var curpfisica = $("#curpfisica").val();
    var sexofisica = $("#sexofisica").val();
    var fechanacimiento = $("#fechanacimiento").val();
    var noidentificacion = $("#noidentificacion").val();
    var tipoIdentificacion = $("#tipoIdentificacion").val();
    var identificacionSt = $("#statusIdentificacion").val();
    var actividad = $("#actividad").val();
    var emailfisica = $("#emailfisica").val();
    var rfcfisica = $("#rfcfisica").val();
    var callefisica = $("#callefisica").val();
    var coloniafisica = $("#coloniafisica").val();
    var codigopostal = $("#codigopostalfisica").val();
    var telefonofisica = $("#telefonofisica").val();
    var tipoTelefonofisica = $("#tipoTelefonofisica").val();

    //Datos de la persona moral
    var noClienteMoral = $("#noClienteMoral").val();
    var nombreMoral = $("#nombremoral").val();
    var aPaternoMoral = $("#apaternomoral").val();
    var aMaternoMoral = $("#amaternomoral").val();
    var curpMoral = $("#curpmoral").val();
    var sexoMoral = $("#sexomoral").val();
    var emailMoral = $("#emailmoral").val();
    var rfcMoral = $("#rfcmoral").val();
    var calleMoral = $("#callemoral").val();
    var coloniaMoral = $("#coloniamoral").val();
    var cpMoral = $("#cpmoral").val();
    var razonSocial = $("#razonsocial").val();
    var fechaConstitucion = $("#fechaConstitucion").val();
    var noFirmaAvanzada = $("#nofirmaavanzada").val();
    var giroC = $("#giroC").val();
    var telefonoPersonaMoral = $("#telefonopersonamoral").val();
    var tipoTelefonoPersonaMoral = $("#tipotelefonopersonamoral").val();

    var datos = [cantidadenviada, tipomoneda, valormoneda,
        instrumentomonetario, tiposervicio, nombrebene,
        apaternobene, amaternobene, idBeneficiario,
        sexobene, clavePersonaFisica, emailfisica,
        rfcfisica, callefisica, coloniafisica,
        codigopostal, noidentificacion, fechanacimiento,
        nombrepersonafisica, apaternofisica, amaternofisica,
        curpfisica, sexofisica, tipoIdentificacion,
        identificacionSt, actividad, telefonofisica, //27
        tipoTelefonofisica, noClienteMoral, nombreMoral,
        aPaternoMoral, aMaternoMoral, curpMoral,
        sexoMoral, emailMoral, rfcMoral, //36
        calleMoral, coloniaMoral, cpMoral,
        razonSocial, fechaConstitucion, noFirmaAvanzada,
        giroC, telefonoPersonaMoral, tipoTelefonoPersonaMoral,
        comisionPago, telBeneficiario, tipoTelBeneficiario];
    /* calleBeneficiario, coloniaBeneficiario, cpBeneficiario, //51
     tipoIdenBene, cveIdentBeneficiario];*/
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    var mensajeModal = "Registrando remesa...";
    blockUI(mensajeModal);
    $.ajax({
        url: "envios/registrarEnvio",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    unBlockUI(100);
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    unBlockUI(100);
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV

                    $("#datosFinalesEnvio").css("display", "none");
                    $("#divImprimirTicket").css("display", "block");
                    unBlockUI(100);
                    ok("Se ha registrado el Pago correctamente");
                    color_div_paso_4();
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    unBlockUI(100);
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            if (jqXHR.status === 0) {

                alert('Not connect: Verify Network.');

            } else if (jqXHR.status === 404) {

                alert('Requested page not found [404]');

            } else if (jqXHR.status === 500) {

                alert('Internal Server Error [500].');

            } else if (textStatus === 'parsererror') {

                alert('Requested JSON parse failed.');

            } else if (textStatus === 'timeout') {

                alert('Time out error.');

            } else if (textStatus === 'abort') {

                alert('Ajax request aborted.');

            } else {

                alert('Uncaught Error: ' + jqXHR.responseText);

            }
        }

    });
}

function datosPersona() {
    if ($("#comisionPago").val() !== "" && $("#cantidadenviada").val() !== ""
            && $("#tipomoneda").val() !== "0") {
        $("#datosenvio").css("display", "none");
        $("#verificaPersona").css("display", "block");
        $("personamoral").prop("disabled", true);
        color_div_paso_2();
        if ($('#personafisica').prop('checked')) {
            $("#divpersonafisica").css("display", "block");
            $("#verificaPersona").css("display", "none");
        }
        if ($('#personamoral').prop('checked')) {
            $("#divpersonamoral").css("display", "block");
        }
    } else {
        error("Debes llenar los campos requeridos.");
    }
}

function datosEnvio() {
    $("#verificaPersona").css("display", "none");
    $("#divpersonafisica").css("display", "none");
    $("#divpersonamoral").css("display", "none");
    $("#datosenvio").css("display", "block");
    color_div_paso_2_anterior();

}

function datosAtrasPersona() {
    $("#beneficiario").css("display", "none");
    $("#verificaPersona").css("display", "block");
    if ($('#personafisica').prop('checked')) {
        $("#divpersonafisica").css("display", "block");
        $("#verificaPersona").css("display", "none");
        $("#tbodyBeneficiarios").empty();
        $("#nombrebene").val("");
        $("#apaternobene").val("");
        $("#amaternobene").val("");
        $("#sexobene").val(0);
        $("#telBeneficiario").val("");
        $("#tipoTelBeneficiario").val(0);
    }
}

/**
 * Función que me permite mostrar el formulario donde se insertan los datos del
 * beneficiario
 * @returns {undefined}
 */
function datosBeneficiario() {
    if (validaPersonaFisica() !== false) {
        $("#verificaPersona").css("display", "none");
        $("#divpersonafisica").css("display", "none");
        $("#divpersonamoral").css("display", "none");
        $("#beneficiario").css("display", "block");
    }

}

/**
 * Función que valida el RFC de una persona física
 * @param {type} rfcFisica
 * @returns {Boolean}
 */
function validaRFCFisica(rfcFisica) {
    let pattern = /^[a-zA-Z]{3,4}(\d{6})((\D|\d){2,3})?$/;
    let rfc = rfcFisica;
    if (!pattern.test(rfc)) {
        error("El formato del RFC no concide");
        return false;
    }
}

/**
 * Función que me permite mostrar el formulario para una persona Fisica o Moral
 * @param {type} valor
 * @returns {undefined}
 */
function selectTipopersona(valor) {
    if (valor === 1) {
        $("#personafisica").removeAttr('checked');
        $("#divpersonafisica").css("display", "none");
        $("#divpersonamoral").css("display", "block");
        buscarOtroCliente();
    }
    if (valor === 2) {
        $("#personamoral").removeAttr('checked');
        $("#divpersonamoral").css("display", "none");
        $("#divpersonafisica").css("display", "block");
        buscarOtroCliente();
    }
}
/*
 * Función que sirve para dar de alta una nueva Entidad Financiera
 * @Author Juan Luis Mendiola 
 */
function agregarEntidad() {
    var organoSupervisor = $("#organoS").val();
    var claveEntidad = $("#claveEnt").val();
    var razonsocial = $("#razonsocial").val();
    var nombrecorto = $("#nombrecorto").val();
    var correoelectronico = $("#correoelectronico").val();
    var rfc = $("#rfc").val();

    //Datos de la dirección
    var calle = $("#calle").val();
    var colonia = $("#colonia").val();
    var codigopostal = $("#codigopostal").val();

    //Datos de la persona
    var nombre = $("#nombre").val();
    var apaterno = $("#apaterno").val();
    var amaterno = $("#amaterno").val();
    var curp = $("#curp").val();
    var sexo = $("#sexo").val();
    var telefono = $("#numtelefono").val();
    var tipotelefono = $("#telefono").val();
    var telefono2 = $("#numtelefono2").val();
    var tipotelefono2 = $("#telefono2").val();
    if (organoSupervisor === '' || claveEntidad === '' || nombrecorto === ''
            || razonsocial === '' || correoelectronico === ''
            || rfc === '' || calle === '' || colonia === '' || telefono === '') {
        error("No debe de quedar un campo vac&iacuteo");
        return false;
    }
    if (validarEmail(correoelectronico) === false) {
        return false;
    }
    if (validaRFC(rfc) === false) {
        return false;
    }
    if (codigopostal === '0') {
        error("Debes de seleccionar un c&oacutedigo postal");
        return false;
    }
    if (nombre === '' || apaterno === '' || amaterno === '') {
        error("Los campos estan vac&iacuteos");
        return false;
    }
    if (validarNombre(nombre) === false) {
        return false;
    }
    if (validarNombre(apaterno) === false) {
        return false;
    }
    if (validarNombre(amaterno) === false) {
        return false;
    }
    if (curp === '') {
        error("La CURP esta vacia");
        return false;
    }
    if (validarCURP(curp) === false) {
        return false;
    }
    if (sexo === '0') {
        error("Debes de seleccionar el sexo");
        return false;
    }
    if (validarTelefono("#numtelefono", telefono) === false) {
        return false;
    }
    if (telefono2 !== '') {
        if (validarTelefono("#numtelefono2", telefono2) === false) {
            return false;
        }
    }
    var datos = [razonsocial,
        nombrecorto,
        correoelectronico,
        rfc,
        calle,
        colonia,
        codigopostal,
        nombre,
        apaterno,
        amaterno,
        curp,
        sexo,
        telefono,
        tipotelefono, organoSupervisor, claveEntidad, telefono2, tipotelefono2];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "entidad/agregarEntidad",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    ok("Los datos se procesar&oacuten CORRECTAMENTE!");
                    setTimeout(function () {
                        location.href = "entidad";
                    }, 1000);
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }

    });
}


/*
 * ´Función que sirve para actualizar una entidad
 * @Author Juan Luis Mendiola Gutiérrez
 */
function actualizarEntidad() {
    var organoSupervisor = $("#organoS").val();
    var claveEntidad = $("#claveEnt").val();
    var razonsocialid = $("#razonsocialid").val();
    var razonsocial = $("#razonsocial").val();
    var nombrecorto = $("#nombrecorto").val();
    var correoelectronico = $("#correoelectronico").val();
    var rfc = $("#rfc").val();

    //Datos de la dirección de la entidad
    var calle = $("#calle").val();
    var colonia = $("#colonia").val();
    var codigopostal = $("#codigopostal").val();

    //Datos de la persona
    var nombre = $("#nombre").val();
    var apaterno = $("#apaterno").val();
    var amaterno = $("#amaterno").val();
    var curp = $("#curp").val();
    var sexo = $("#sexo").val();
//datos telefono
    var idtel = $("#idtel").val();
    var telefono = $("#numtelefono").val();
    var tipotelefono = $("#telefono").val();
    var idtel2 = $("#idtel2").val();
    var telefono2 = $("#numtelefono2").val();
    var tipotelefono2 = $("#telefono2").val();
    if (organoSupervisor === '' || claveEntidad === '' || nombrecorto === ''
            || razonsocial === '' || correoelectronico === ''
            || rfc === '' || calle === '' || colonia === '' || telefono === '') {
        error("No dede de quedar un campo vac&iacuteo");
        return false;
    }
    if (validarEmail(correoelectronico) === false) {
        return false;
    }
    if (validaRFC(rfc) === false) {
        return false;
    }
    if (codigopostal === '0') {
        error("Debes de seleccionar un c&oacutedigo postal");
        return false;
    }
    if (nombre === '' || apaterno === '' || amaterno === '') {
        error("Los campos estan vac&iacuteos");
        return false;
    }
    if (validarNombre(nombre) === false) {
        return false;
    }
    if (validarNombre(apaterno) === false) {
        return false;
    }
    if (validarNombre(amaterno) === false) {
        return false;
    }
    if (curp === '') {
        error("La CURP esta vacia");
        return false;
    }
    if (validarCURP(curp) === false) {
        return false;
    }
    if (sexo === '0') {
        error("Debes de seleccionar el sexo");
        return false;
    }
    if (validarTelefono("#numtelefono", telefono) === false) {
        return false;
    }
    if (telefono2 !== '') {
        if (validarTelefono("#numtelefono2", telefono2) === false) {
            return false;
        }
    }
    var datos = [razonsocial,
        nombrecorto,
        correoelectronico,
        rfc,
        calle,
        colonia,
        codigopostal,
        nombre,
        apaterno,
        amaterno,
        curp, sexo,
        razonsocialid, organoSupervisor, claveEntidad,
        idtel, telefono, tipotelefono, idtel2, telefono2, tipotelefono2];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });

    $.ajax({
        url: "entidad/actualizarEntidad",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    ok("Los datos se procesar&oacuten CORRECTAMENTE!");
                    setTimeout(function () {
                        location.href = "entidad";
                    }, 1000);
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }

    });
}

/**
 * función que valida el rfc de un persona Moral
 * @param {type} rfcCaja
 * @returns {undefined}
 */
function validaRFC(rfcCaja) {
    let pattern = /^[a-zA-Z]{3,4}(\d{6})((\D|\d){2,3})?$/;
    let rfc = rfcCaja;
    if (!pattern.test(rfc)) {
        error("El formato del RFC no concide");
        return false;
    } else {
        return true;
    }
}
function validarNombreSucEnt(valorNombre) {
    var valNom = /^([A-Za-zñÑáéíóúÁÉÍÓÚ\s]{3,})$/;
    if (!valNom.test(valorNombre)) {
        error("El nombre no es valido");
        return false;
    }
}
/*
 * Función que sirve para eleiminar una Entidad Financiera 
 * @returns 
 */
function eliminarEntidad(entidadid) {

    var datos = [entidadid];

    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });

    $.ajax({
        url: "entidad/eliminarEntidad",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    ok("Los datos se procesar&oacuten CORRECTAMENTE!");
                    setTimeout(function () {
                        location.href = "entidad";
                    }, 1000);
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });
}


/*
 * Método que llena las cajas de texto al momento de actualizar una entidad
 */
function completaInputsEntidad() {
    $("#guardar").css("display", "none");
    $("#actualizar").prop("disabled", false);
    $("#tableEntidad tbody").on('click', 'tr', function () {
        var razonsocialid = $('td', this).eq(0).text();
        var claveOrgano = $('td', this).eq(2).text();
        var claveEntidad = $('td', this).eq(3).text();
        var razonsocial = $('td', this).eq(4).text();
        var nombrecorto = $('td', this).eq(5).text();
        var correoelectronico = $('td', this).eq(6).text();
        var rfc = $('td', this).eq(7).text();
        var calle = $('td', this).eq(8).text();
        var colonia = $('td', this).eq(9).text();
        var codigopostal = $('td', this).eq(10).text();
        var nombre = $('td', this).eq(12).text();
        var apaterno = $('td', this).eq(13).text();
        var amaterno = $('td', this).eq(14).text();
        var curp = $('td', this).eq(15).text();
        var sexo = $('td', this).eq(16).text();
        var tipoTel = $('td', this).eq(18).text();
        var numTel = $('td', this).eq(21).text();
        var tipoTel2 = $('td', this).eq(22).text();
        var numTel2 = $('td', this).eq(25).text();
        var idtel = $('td', this).eq(20).text();
        var idtel2 = $('td', this).eq(24).text();
        $("#idtel").val(idtel);
        $("#idtel2").val(idtel2);
        $("#organoS").val(claveOrgano);
        $("#claveEnt").val(claveEntidad);
        $("#razonsocialid").val(razonsocialid);
        $("#razonsocial").val(razonsocial);
        $("#nombrecorto").val(nombrecorto);
        $("#correoelectronico").val(correoelectronico);
        $("#rfc").val(rfc);
        $("#calle").val(calle);
        $("#colonia").val(colonia);
        $("#codigopostal").val(codigopostal).text();
        $("#nombre").val(nombre);
        $("#apaterno").val(apaterno);
        $("#amaterno").val(amaterno);
        $("#curp").val(curp);
        $("#sexo").val(sexo);
        $("#numtelefono").val(numTel);
        $("#telefono").val(tipoTel);
        $("#numtelefono2").val(numTel2);
        $("#telefono2").val(tipoTel2);
    });

}

/**
 * Función para limpiar las cajas de una entidad
 * 
 */
function limpiarCajasEntidad() {
    $("#nombre").val("");
}


/**
 * Función para agregar una sucursal
 */
function agregarSucursal() {

    var nombresucursal = $("#nombresucursal").val();
    var nosucursal = $("#nosucursal").val();
    var correoelectronico = $("#correoelectronico").val();

    //Datos de la dirección
    var calle = $("#calle").val();
    var colonia = $("#colonia").val();
    var codigopostal = $("#codigopostal").val();

    //Datos de la persona

    var nombre = $("#nombre").val();
    var apaterno = $("#apaterno").val();
    var amaterno = $("#amaterno").val();
    var curp = $("#curp").val();
    var sexo = $("#sexo").val();
    var telefono = $("#numtelefono").val();
    var tipotelefono = $("#telefono").val();
    var idtel = $("#idtel").val();
    var telefono2 = $("#numtelefono2").val();
    var tipotelefono2 = $("#telefono2").val();
    var idtel2 = $("#idtel2").val();

    var entidad = $("#entidadF").val();

    //Mensaje de al usuario
    var mensaje = "Espere mientras se insertan los datos";
    var mensajealerta = "Seguro que desea guardar los datos...";
    var regreso = "entidad/agregarEntidad";

    //falta extraer los datos de los campos de direccion y persona
    if (nombresucursal === '' || nosucursal === '' || correoelectronico === ''
            || calle === '' || colonia === '' || nombre === '' || apaterno === ''
            || amaterno === '' || curp === '' || telefono === '') {
        error("Hay campos vac&iacuteos");
        return false;
    }
    if (codigopostal === 0) {
        error("Debes de seleccionar un c&oacutedigo postal");
        return false;
    }
    if (sexo === 0) {
        error("Debes de seleccionar el sexo de la persona");
        return false;
    }
    if (tipotelefono === 0) {
        error("Debes de seleccionar el tipo de telefono");
        return false;
    }
    if (validarNombreSucEnt(nombresucursal) === false) {
        return false;
    }
    if (nosucursal.length < 2 || nosucursal.length > 10) {
        error("La longitud m&iacutenima es de 2 caracteres y m&aacutexima de 10");
        return false;
    }
    if (validarEmail(correoelectronico) === false) {
        return false;
    }
    if (validarCalle(calle) === false) {
        return false;
    }
    if (validarColonia(colonia) === false) {
        return false;
    }
    if (validarNombre(nombre) === false) {
        return false;
    }
    if (validarNombre(apaterno) === false) {
        return false;
    }
    if (validarNombre(amaterno) === false) {
        return false;
    }
    if (validarCURP(curp) === false) {
        return false;
    }
    if (validarTelefono("#numtelefono", telefono) === false) {
        return false;
    }
    if (telefono2 !== '') {
        if (validarTelefono("#numtelefono2", telefono2) === false) {
            return false;
        }
    }
    var datos = [nombresucursal,
        nosucursal,
        correoelectronico,
        calle,
        colonia,
        codigopostal,
        nombre,
        apaterno,
        amaterno,
        curp,
        sexo,
        telefono,
        tipotelefono, //12
        entidad, idtel, telefono2, tipotelefono2, idtel2];//17datos
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "sucursal/agregarSucursal",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    ok("Los datos se procesarón CORRECTAMENTE!");
                    setTimeout(function () {
                        location.href = "sucursal";
                    }, 1000);
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }

    });
}

/*
 * Función que sirve para actualizar una sucursal
 * @param {type} sucursalid
 * @returns {undefined}
 */
function actualizarSucursal() {
    var sucursalid = $("#sucursalid").val();
    var nombresucursal = $("#nombresucursal").val();
    var nosucursal = $("#nosucursal").val();
    var correoelectronico = $("#correoelectronico").val();

    //Datos de la dirección
    var calle = $("#calle").val();
    var colonia = $("#colonia").val();
    var codigopostal = $("#codigopostal").val();

    //Datos de la persona

    var nombre = $("#nombre").val();
    var apaterno = $("#apaterno").val();
    var amaterno = $("#amaterno").val();
    var curp = $("#curp").val();
    var sexo = $("#sexo").val();
    var telefono = $("#numtelefono").val();
    var tipotelefono = $("#telefono").val();
    var idtel = $("#idtel").val();
    var telefono2 = $("#numtelefono2").val();
    var tipotelefono2 = $("#telefono2").val();
    var idtel2 = $("#idtel2").val();
    var entidad = $("#entidadF").val();


    //Mensaje de al usuario
    var mensaje = "Espere mientras se insertan los datos";
    var mensajealerta = "Seguro que desea guardar los datos...";
    var regreso = "entidad/agregarEntidad";

    //falta extraer los datos de los campos de direccion y persona
    if (nombresucursal === '' || nosucursal === '' || correoelectronico === ''
            || calle === '' || colonia === '' || nombre === '' || apaterno === ''
            || amaterno === '' || curp === '' || telefono === '') {
        error("Hay campos vac&iacuteos");
        return false;
    }
    if (codigopostal === 0) {
        error("Debes de seleccionar un c&oacutedigo postal");
        return false;
    }
    if (sexo === 0) {
        error("Debes de seleccionar el sexo de la persona");
        return false;
    }
    if (tipotelefono === 0) {
        error("Debes de seleccionar el tipo de telefono");
        return false;
    }
    if (validarNombreSucEnt(nombresucursal) === false) {
        return false;
    }
    if (nosucursal.length < 2 || nosucursal.length > 10) {
        error("La longitud m&iacutenima es de 2 caracteres y m&aacutexima de 10");
        return false;
    }
    if (validarEmail(correoelectronico) === false) {
        return false;
    }
    if (validarCalle(calle) === false) {
        return false;
    }
    if (validarColonia(colonia) === false) {
        return false;
    }
    if (validarNombre(nombre) === false) {
        return false;
    }
    if (validarNombre(apaterno) === false) {
        return false;
    }
    if (validarNombre(amaterno) === false) {
        return false;
    }
    if (validarCURP(curp) === false) {
        return false;
    }
    if (validarTelefono("#numtelefono", telefono) === false) {
        return false;
    }
    if (telefono2 !== '') {
        if (validarTelefono("#numtelefono2", telefono2) === false) {
            return false;
        }
    }
    var datos = [nombresucursal,
        nosucursal,
        correoelectronico,
        calle,
        colonia,
        codigopostal,
        nombre,
        apaterno,
        amaterno,
        curp,
        sexo,
        telefono,
        tipotelefono,
        entidad,
        sucursalid, idtel, telefono2, tipotelefono2, idtel2];
    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });
    $.ajax({
        url: "sucursal/actualizarSucursal",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    ok("Los datos se procesarón CORRECTAMENTE!");
                    setTimeout(function () {
                        location.href = "sucursal";
                    }, 1000);
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }

    });
}

/**
 * Función que sirve para eliminar una sucursal
 * @param {int} sucursalid 
 */
function eliminarSucursal(sucursalid) {
    var datos = [sucursalid];
    alert(sucursalid);

    $(document).ajaxSend(function (e, xhr, options) {
        var token = $("input[name='_csrf']").val();
        var cabecera = "X-CSRF-TOKEN";
        xhr.setRequestHeader(cabecera, token);
    });

    $.ajax({
        url: "sucursal/eliminarSucursal",
        data: {datos: datos},
        dataType: 'html',
        type: 'POST',
        success: function (retorno) {
            //alert(retorno);
            switch (retorno) {
                case 'errorDato':
                    alert("Los datos no se procesaron correctamente");
                    break;
                case 'error':
                    alert("Se ha producido un error en el servidor");
                    break;
                case 'exito':
                    //carga lo que se indica en id DIV
                    ok("Los datos se procesarón CORRECTAMENTE!");
                    setTimeout(function () {
                        location.href = "sucursal";
                    }, 1000);
                    break;
                case 'errorAcceso':
                    alert("No ha iniciado sesion");
                    break;
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Se ha producido un error en el servidor");
        }
    });

}

function completaInputsSucursal() {
    $("#guardar").css("display", "none");
    $("#actualizar").prop("disabled", false);
    $("#tableSucursal tbody").on('click', 'tr', function () {
        var sucursalid = $('td', this).eq(0).text();
        var nombresucursal = $('td', this).eq(2).text();
        var nosucursal = $('td', this).eq(3).text();
        var correoelectronico = $('td', this).eq(4).text();
        var tipoTelId = $('td', this).eq(5).text();
        var idTel = $('td', this).eq(7).text();
        var numtel = $('td', this).eq(8).text();
        var tipoTelId2 = $('td', this).eq(9).text();
        var idTel2 = $('td', this).eq(11).text();
        var numtel2 = $('td', this).eq(12).text();
        var calle = $('td', this).eq(13).text();
        var colonia = $('td', this).eq(14).text();
        var codigopostal = $('td', this).eq(15).text();
        var nombre = $('td', this).eq(17).text();
        var apaterno = $('td', this).eq(18).text();
        var amaterno = $('td', this).eq(19).text();
        var curp = $('td', this).eq(20).text();
        var sexo = $('td', this).eq(21).text();
        var entidad = $('td', this).eq(23).text();


        $("#sucursalid").val(sucursalid);
        $("#nombresucursal").val(nombresucursal);
        $("#nosucursal").val(nosucursal);
        $("#correoelectronico").val(correoelectronico);
        $("#calle").val(calle);
        $("#colonia").val(colonia);
        $("#codigopostal").val(codigopostal);
        $("#nombre").val(nombre);
        $("#apaterno").val(apaterno);
        $("#amaterno").val(amaterno);
        $("#curp").val(curp);
        $("#sexo").val(sexo);
        $("#entidadF").val(entidad);
        $("#numtelefono").val(numtel);
        $("#idtel").val(idTel);
        $("#telefono").val(tipoTelId);
        $("#numtelefono2").val(numtel2);
        $("#idtel2").val(idTel2);
        $("#telefono2").val(tipoTelId2);

    });
}
